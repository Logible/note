# 四、数据库的安全性和完整性

- [四、数据库的安全性和完整性](#四数据库的安全性和完整性)
  - [要求考生掌握什么是数据库的安全性问题](#要求考生掌握什么是数据库的安全性问题)
  - [要求考生牢固掌握数据库管理系统实现数据库安全性控制的常用方法和技术](#要求考生牢固掌握数据库管理系统实现数据库安全性控制的常用方法和技术)
  - [要求考生理解什么是数据库的完整性，掌握用 SQL 语言定义关系模式的完整性约束条件](#要求考生理解什么是数据库的完整性掌握用-sql-语言定义关系模式的完整性约束条件)
    - [实体完整性](#实体完整性)
    - [参照完整性](#参照完整性)
    - [域完整性](#域完整性)
    - [用户定义完整性等](#用户定义完整性等)

The follows is what we need to master in teaching. Can you explain his concept and then give corresponding examples and write corresponding codes?

要求考生理解什么是数据库的完整性，掌握用 SQL 语言定义关系模式的完整性约束条件。

## 要求考生掌握什么是数据库的安全性问题

- 数据库安全性是指保护数据库及其相关基础架构，**以防止未经授权的访问、修改或破坏**。确保数据库安全性对于维护存储在其中的数据的**保密性、完整性和可用性**至关重要。

- 有几个需要考虑的安全问题来确保数据库的安全，包括：

1. 身份验证：确保只有**授权用户**才能访问数据库。
2. 授权：向授权用户**授予适当的权限**，以访问和修改特定数据。
3. 数据加密：通过在**传输和静态存储期间**对其进行加密，来保护敏感数据。
4. 数据备份和恢复：定期**备份**数据并拥有灾难**恢复计划**，以确保在灾难或系统故障情况下的数据可用性。
5. 审计跟踪：记录**所有数据库活动的日志**，以监视和跟踪任何未经授权的访问或修改。

## 要求考生牢固掌握数据库管理系统实现数据库安全性控制的常用方法和技术

- 数据库管理系统实现数据库安全性控制的常用方法和技术包括：

1. 访问控制：访问控制是指**对数据库中的对象进行权限控制**，以确保只有授权用户才能访问数据库中的敏感数据。在访问控制中，可以使用一些技术来限制用户的访问权限，例如用户身份验证、授权和角色授权等。

    ```sql
    -- 创建用户并授权
    CREATE USER test_user IDENTIFIED BY 'test_password';
    GRANT SELECT, INSERT, UPDATE ON test_table TO test_user;
    ```

2. 数据加密：数据加密技术可以在传输和存储期间对数据库中的敏感数据进行加密，以保护数据不被未经授权的用户访问和使用。

    ```sql
    -- 使用TDE（透明数据加密）对敏感数据进行加密
    ALTER TABLE test_table ADD ENCRYPTED_COLUMN VARCHAR2(50) ENCRYPT;
    ```

3. 审计跟踪：审计跟踪技术可以记录和监视数据库的所有活动，包括用户登录、对象访问和修改等。这可以帮助管理员识别潜在的安全威胁，并提供日志记录以用于后续审查

    ```sql
    -- 启用审计跟踪
    AUDIT SELECT, INSERT, UPDATE ON test_table BY ACCESS;
    ```

4. 数据备份和恢复：备份和恢复技术可以确保在系统故障或灾难发生时能够快速恢复数据库，并保证数据的可用性和完整性。

    ```sql
    -- 创建数据库备份
    RMAN> BACKUP DATABASE PLUS ARCHIVELOG;
    ```

5. 数据库安全性策略：数据库安全性策略是一个全面的计划，用于识别潜在的安全威胁和漏洞，并制定相应的措施来加强数据库的安全性。这**包括规定用户账户和密码管理、定期更新安全补丁、加强访问控制、实施数据加密和备份**等。

## 要求考生理解什么是数据库的完整性，掌握用 SQL 语言定义关系模式的完整性约束条件

- 数据库的完整性
  - 是指数据库中的数据满足**一定的准则和规范**，以确保数据的**一致性和可靠性**。
- 在数据库中，完整性约束是用于**限制和保护数据完整性**的一种方法，包括
  - 实体完整性
  - 参照完整性
  - 域完整性
  - 用户定义完整性等

### 实体完整性

- 实体完整性：实体完整性是指在数据库表中，**每一行都应该能够唯一地被标识和访问**，以确保数据的正确性和一致性。在实体完整性约束中，可以使用**主键或唯一约束**来保证每一行的唯一性。

```sql
-- 使用主键约束来保证每一行的唯一性
CREATE TABLE test_table (
  id NUMBER(10) PRIMARY KEY,
  name VARCHAR2(50)
);
```

### 参照完整性

- 参照完整性是指在数**据库中的关系表之间**，通过**外键约束来保证数据的一致性和完整性**。**外键约束可以确保关系表中的数据满足参照表的关系条件**，以避免无效或不一致的数据出现。

```sql
-- 使用外键约束来确保关系表中的数据满足参照表的关系条件
CREATE TABLE orders (
  order_id NUMBER(10),
  product_id NUMBER(10),
  quantity NUMBER(5),
  CONSTRAINT fk_product FOREIGN KEY (product_id) REFERENCES products (product_id)
);
```

### 域完整性

- 域完整性是指**对数据库中的数据进行规范化和验证**，以确保数据符合指定的**数据类型、范围和格式**。在域完整性约束中，可以使用检查约束来限制数据的取值范围和格式。

```sql
-- 使用检查约束来限制数据的取值范围和格式
CREATE TABLE employees (
  employee_id NUMBER(10),
  last_name VARCHAR2(50),
  salary NUMBER(10, 2) CHECK (salary >= 0)
);
```

### 用户定义完整性等

- 用户定义完整性：用户定义完整性是指**在数据库中的数据满足用户定义的业务规则和条件**。在用户定义完整性约束中，可以使用触发器和存储过程等技术来实现。

```sql
-- 使用触发器来实现用户定义的业务规则和条件
CREATE TRIGGER salary_check
BEFORE INSERT OR UPDATE ON employees
FOR EACH ROW
BEGIN
  IF :NEW.salary < 0 THEN
    RAISE_APPLICATION_ERROR(-20001, 'Salary cannot be negative');
  END IF;
END;
```

- In Oracle PL/SQL, :**NEW** is a predefined record that refers to the new values that are being inserted or updated in a row of a database table.
