# 概述

- [概述](#概述)
  - [1.简述操作系统的目标和功能（什么是操作系统）](#1简述操作系统的目标和功能什么是操作系统)
  - [2.简述处理机的两种状态](#2简述处理机的两种状态)
    - [2.1 两种状态对应的两种程序](#21-两种状态对应的两种程序)
  - [3. 简述操作系统的层次结构](#3-简述操作系统的层次结构)
  - [4. 中断和异常](#4-中断和异常)
    - [4.1 I/O操作](#41-io操作)
    - [4.2 定时器到达指定时间](#42-定时器到达指定时间)
    - [4.3 指令陷入](#43-指令陷入)
  - [中断流程](#中断流程)
  - [5.系统调用](#5系统调用)
  - [触发中断的事件](#触发中断的事件)
  - [6. 简述大内核和微内核](#6-简述大内核和微内核)
    - ["所有服务都是在用户空间中运行"](#所有服务都是在用户空间中运行)
    - [用户空间（User Space）](#用户空间user-space)

## 1.简述操作系统的目标和功能（什么是操作系统）

## 2.简述处理机的两种状态

处理机是指计算机中的中央处理器(CPU)。在计算机中，处理机有两种基本状态：用户态和内核态。

- 用户态(User Mode)：在用户态下，处理机只能访问**用户空间中的资源**，例如**用户程序和用户数据**。此时，处理机只能执行受限制的操作，并且不能直接访问系统资源，如磁盘、网络等。在用户态下，处理机是受限制的状态，因为它没有足够的权限来执行一些特权操作。

- 内核态(Kernel Mode)：在内核态下，处理机可以访问**所有的系统资源**，包括**操作系统内核和所有的设备驱动程序**等。此时，处理机具有更高的特权级别，因此可以执行所有的操作，并且可以直接访问所有的系统资源。在内核态下，处理机拥有完全的控制权，可以执行任何操作。

用户态和内核态的转换是由操作系统管理的，当用户程序需要执行特权操作或者访问系统资源时，必须通过**系统调用等机制切换到内核态**，并且必须获得内核的授权才能执行操作。当操作完成后，处理机再次切换回用户态，继续执行用户程序。这种切换和授权的机制保证了系统的安全性和稳定性，同时也保证了用户程序和系统内核的隔离

### 2.1 两种状态对应的两种程序

CPU 可以执行两种性质的程序：操作系统内核程序和用户自编程程序。

- 操作系统内核程序
  - 操作系统内核程序是一种运行在计算机系统**内核态(kernel mode)**下的程序，它**负责管理计算机系统的各种资源和任务**。内核程序是操作系统的核心组成部分，它可以访问系统的硬件资源，如 CPU、内存、硬盘等，并且负责管理进程、文件系统、网络等各种系统服务。内核程序通常被设计为高度优化的代码，以保证其能够快速响应各种系统任务。
  - 操作系统内核程序是由操作系统开发人员编写的，因此它们通常是高度复杂的程序。内核程序的错误会导致系统崩溃或者出现安全漏洞，因此操作系统开发人员需要花费大量的时间和精力来测试和验证内核程序的正确性。

- 用户自编程程序
  - 用户自编程程序是一种运行在计算机系统**用户态(user mode)**下的程序，它是由用户自己编写的，用于实现特定的功能或者解决特定的问题。用户自编程程序通常需要调用操作系统提供的系统调用接口，以便访问系统资源和服务。
  - 用户自编程程序可以用各种编程语言编写，如 C、C++、Java、Python 等。用户自编程程序的功能可以非常丰富，例如图形界面应用程序、游戏、科学计算软件、数据库管理系统等等。用户自编程程序通常需要经过编译、链接等一系列工作，才能被 CPU 执行。

- 总之，CPU 可以执行两种性质的程序，操作系统内核程序和用户自编程程序。操作系统内核程序是系统核心的组成部分，负责管理和控制**各种系统资源和服务**；而用户自编程程序则是用户自己编写的程序，用于实现**特定的功能或者解决特定的问题**。

## 3. 简述操作系统的层次结构

- 操作系统的层次结构可以分为底层和上层两部分。

- 底层：底层是操作系统的核心部分，包括硬件抽象层和内核层。
  - **硬件抽象层**是对硬件设备的抽象，负责管理和控制硬件资源，如处理器、内存、外设等。
  - **内核层**是操作系统的核心部分，负责管理和调度各种系统资源，如进程、线程、内存、设备等，并**提供了系统调用接口**，应用程序可以通过系统调用向内核层请求服务和资源。

- 上层：上层包括应用程序支撑层、用户接口层和应用程序层。
  - **应用程序支撑层**提供了各种服务和功能，帮助**应用程序完成任务**，如进程管理、文件系统、网络通信等。
  - **用户接口层**负责提供**与用户交互的接口**，包括命令行接口、图形用户界面(GUI)等。
  - **应用程序层**是操作系统最上层，包括各种应用软件，如文本编辑器、浏览器、多媒体播放器等，用户可以通过这些应用程序来完成不同的任务。

## 4. 中断和异常

- 中断的作用
  - **让操作系统内核强行夺回CPU的控制权**
  - 使CPU从用户态变为内核态

- 中断是指计算机在执行程序时，由外部事件（如I/O设备的输入输出、定时器的计时等）或者软件请求（如系统调用、指令陷入等）产生的信号，通知处理器立即**暂停当前工作，转而去处理中断事件所需的操作**，处理完成后再返回原先的工作。
- 异常是指在程序执行过程中，发生了不可预测或非法的操作，例如除零、越界、非法指令等，这时**系统会产生异常信号**，通知处理器转而去处理异常的情况。

- 它们的相同点是：
  - 都是由硬件或软件发出的信号，通知处理器转而去处理事件或错误。
  - 处理时都会保存当前的现场信息，以便在处理完后恢复现场继续执行。
  - 处理完后都需要返回到原来的执行位置，继续执行之前的任务。

- 它们的不同点是：
  - 中断是由外部事件或软件请求发出的，而异常则是由程序执行过程中的非法操作所引起的。
  - 中断是可预测的，而异常则是不可预测的。
  - 处理的方式不同。
    - 中断的处理方式是直接暂停当前工作，转而去处理中断事件所需的操作，处理完成后**再返回原先的工作**。
    - 而异常的处理方式是根据异常类型，对当前的程序执行进行一定**的调整或者是终止**。

### 4.1 I/O操作

- I/O设备读写操作是指计算机通过输入/输出接口与外部设备进行数据的读取和写入操作。外部设备可以是磁盘、键盘、鼠标、打印机、网络等各种设备。这些设备通过I/O接口与计算机相连，与计算机进行数据交换。
  - **读操作**通常是指从外部设备中读取数据到计算机内存中，以便后续的处理。例如，计算机从磁盘中读取文件数据到内存中，从键盘中读取用户输入的数据到内存中等。
  - **写操作**通常是指将计算机内存中的数据写入到外部设备中。例如，计算机将数据写入磁盘，以便将其永久保存，将数据写入打印机，以便打印出来等。

- I/O设备读写操作是计算机系统中非常重要的一部分，因为计算机需要通过外部设备与外界进行交互，读取数据、写入数据等操作是计算机与外部设备进行数据交换的核心。为了实现高效的I/O操作，操作系统提供了各种优化技术，比如缓存、异步I/O等。

### 4.2 定时器到达指定时间

- 定时器到达指定时间是指在计算机中，硬件定时器或软件定时器在经过一定的时间后，**达到预设的时间点**。这个时间点可以用来**触发中断、执行特定的操作或发送信号**等。

### 4.3 指令陷入

- "指令陷入"是指处理器在执行指令时，遇到了特殊的指令或者指令标记（如"陷阱门(trap door)"或"**陷阱指令**(trap instruction)"），处理器便会**暂停当前的工作，将控制权转移到操作系统内核**，让内核来处理这个指令或标记所对应的操作。这个过程也称为"陷入(trap)"或"例外(exception)"。在操作系统中，指令陷入通常**用于实现系统调用**、异常处理、中断处理等功能。

## 中断流程

中断处理流程通常包括以下几个步骤：

1. 中断触发：当硬件设备或软件程序需要**操作系统内核的处理**时，会向**处理器发出中断请求**。
2. 中断响应：当处理器接收到中断请求后，会立即**暂停当前的工作**，将现场信息（如程序计数器、寄存器等状态）**保存到堆栈中**，并跳转到中断处理程序中。
3. 中断处理：中断处理程序负责完成中断请求所需要的工作，包括**保存被中断程序的上下文信息、执行中断服务程序、响应设备操作**等。
4. 中断结束：中断处理程序完成后，需要**恢复被中断程序的上下文信息，并将控制权返回给被中断程序**，让它继续执行之前的工作。

## 5.系统调用

![20230318102441](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230318102441.png)

- 系统调用
  - 是操作系统提供给**用户程序的一种接口**，它允许用户程序请求操作系统内核来完成底层资源和服务的操作。例如，用户程序可以使用系统调用来访问文件系统、网络通信、硬件设备等底层资源，或者请求操作系统提供的服务，如进程管理、内存管理等。
  - 系统调用的实现通常需要使用**中断机制**和系统调用表。中断机制是操作系统用于响应外部事件的机制，用户程序可以使用中断来触发系统调用。系统调用表是一个指针数组，它包含了操作系统内核中实现的所有系统调用函数的入口地址，用户程序可以通过中断和系统调用表来访问操作系统提供的各种服务和资源。

## 触发中断的事件

1. 硬件中断：当硬件设备需要操作系统处理时，它会向处理器发送一个中断请求。例如，键盘输入、鼠标移动、网络数据包到达等事件都可以触发硬件中断。
2. 软件中断：软件中断是由程序主动发起的中断请求，它通常用于实现操作系统的系统调用。例如，当用户程序需要使用操作系统提供的服务时，它会通过软件中断请求进入内核空间，执行相应的系统调用函数。
3. 异常中断：异常中断是由硬件或软件发生的异常事件触发的中断。例如，硬件错误、内存访问异常、非法指令执行等事件都可能引发异常中断。
4. 时钟中断：时钟中断是由处理器定时器定时产生的中断，它可以用于实现操作系统的进程调度和时间片轮转。

## 6. 简述大内核和微内核

- 大内核和微内核是两种不同的**操作系统内核架构设计**。

- 大内核是一种**单体化的操作系统内核架构**，它将所有操作系统服务和功能集成到一个单独的核心中。它包含了**操作系统的所有核心功能**，如进程管理、文件系统、设备驱动程序等，这些功能都是在内核空间中实现的。由于所有服务都在同一个内核中，因此系统的**性能**通常比较高，但内核的**稳定性和安全性**也可能受到威胁。
- 微内核是一种**分散化的操作系统内核架构**，它**只包含最基本的操作系统服务和功能**，如进程管理、内存管理和进程间通信等。其他服务和功能都是在用户空间中实现的。这意味着微内核的内核空间非常小，因此它更加**稳定和安全**。另外，由于所有服务都是在用户空间中运行，因此微内核具有很高的灵活性和可扩展性。

### "所有服务都是在用户空间中运行"

- 是指在微内核操作系统中，除了最基本的操作系统服务和功能，例如进程管理、内存管理和进程间通信等，所有其他服务和功能都是在**用户空间**中实现的。这些服务包括**文件系统、网络协议栈、设备驱动程序**等。由于这些服务在用户空间中运行，它们的错误或故障不会影响操作系统内核的稳定性和安全性。同时，这也提高了系统的灵活性和可扩展性，因为可以动态地加载或卸载用户空间的服务和功能。

### 用户空间（User Space）

- 是指操作系统中的一部分，它是指用户程序**运行的虚拟内存空间**，也就是说，在用户空间内运行的程序不能直接访问操作系统内核或硬件资源。
- 用户空间通常包含用户应用程序、库文件和一些用户配置文件等，这些程序和文件都是在操作系统内核的支持下运行的。
- 用户空间和内核空间（Kernel Space）是操作系统中的两个主要部分，它们通过操作系统内核提供的接口进行通信和交互，以提供完整的操作系统功能。用户空间和内核空间的分离可以**增强操作系统的安全性和稳定性**，因为只有内核空间可以访问和控制硬件资源，而用户空间程序的错误或故障不会影响整个系统的稳定性和安全性。
