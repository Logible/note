# 文件

- [文件](#文件)
  - [9.1文件和流的概念](#91文件和流的概念)
    - [9.1.2流的定义](#912流的定义)
  - [9.2 文件的使用](#92-文件的使用)
    - [9.2.1 文件的打开与关闭](#921-文件的打开与关闭)
    - [9.2.2 文件的读写操作](#922-文件的读写操作)
      - [1.判断文件是否结束](#1判断文件是否结束)
      - [2.读写字符函数fgetc和fputc的使用](#2读写字符函数fgetc和fputc的使用)
      - [3.读写字符串函数fgets和fputs的使用](#3读写字符串函数fgets和fputs的使用)
      - [4.格式化输入、输出函数fscanf和fprintf](#4格式化输入输出函数fscanf和fprintf)
      - [5.块读写函数fread和fwrite的使用](#5块读写函数fread和fwrite的使用)
    - [9.2.3 文件指针的定位](#923-文件指针的定位)
    - [9.2.4 出错的检测](#924-出错的检测)
  - [习题](#习题)
    - [填空题](#填空题)
  - [程序填空题](#程序填空题)

## 9.1文件和流的概念

### 9.1.2流的定义

- C语言把每个**独立的数据流**称作文件，每个文件都存储在相应的目录(或者文件夹)下，文件用文件名(包括文件的目录路径)来标识

- 文件类型指针
  - 打开文件操作将返回一个**指向FILE的指针**(称为文件指针),它代表所创建的流，对这个流的**所有操作都将通过这个指针进行**。
  - 因此也可以认为文件指针就是流的体现，人们也把文件指针作为流的代名词。

## 9.2 文件的使用

```c
int feof(FILE *stream);

int fgetc(FILE *stream);
int fputc(int ch,FILE *stream);

char *fgets(char *str,int num,FILE *stream);
int fputs(char *str,FILE *stream);

size_t fread(void *pointer,size_t size,size_t num,FILE*stream);
size_t fwrite(void *pointer,size_t size,size_t num,FILE *stream)
```

### 9.2.1 文件的打开与关闭

```c
FILE* fopen(const char *filename,const char * mode);

FILE *fp;
fp = fopen("myfile_address","r");//打开一个文本文件只读
if(fp == NULL){
    /*当文件打不开时的处理*/
}
/* 对文件的各种操作 */
fclose(fp);
```

- fopen参数
  - ![20230401145334](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230401145334.png)
  - 包含w才能创建新文件

### 9.2.2 文件的读写操作

#### 1.判断文件是否结束

```C
int feof(FILE *stream);
```

- 函数的返回值若是**非0的数**，则说明文件指针已指向文件的结尾了

```C
while(!feof(fp))
  putchar(fgetc(fp));
```

#### 2.读写字符函数fgetc和fputc的使用

- fgetc函数从输入流的当前位置**返回一个字符**，并将文件指针**指示器移到下一个字符处**，如果已到文件尾，函数返回EOF

  ```c
  int fgetc(FILE *stream);
  /*从文件读一字符*/
  ch = fgetc(fp);
  ```

  ```c
  if((fp = fopen(argv[0],"r"))==NULL) {
    printf("not open");
    return 0;
  }

  while(!feof(fp)) {
    ch = fgetc(fp);
    putchar(ch);
  }
  ```

- fputc函数完成将字符ch的值**写入所指定的流文件的当前位置处**，并将文件指针后移一位。fputc函数的**返回值是所写入字符的值**，出错时返回EOF。

  ```c
  int fputc(int ch,FILE *stream);
  //*将一个字符写入文件*/
  fputc(ch,fp);
  ```

  ```c
  FILE*fp;
  char ch;
  if((fp = fopen("D:\\test.txt","w"))==NULL) {
    printf("cannot open file!\n");
    exit(0);
  }

  while((ch=getchar())!='\n')
    fputc(ch,fp); /*将一个字符写入文件*/
  fclose(fp);
  return 0;

  D:\>type test.txt
  12345
  ```

#### 3.读写字符串函数fgets和fputs的使用

- fgets函数从流文件stream中读取至多num-1个字符，并把它们放入str指向的字符数组中。
  - 读取字符直到遇见按Enter键符
  - 或EOF(文件结束符)为止
  - 或读入了所限定的字符数。

```c
char *fgets(char *str,int num,FILE *stream);

//从文件中读回的字符串长度大于0
while(fgets(str,128,fp1)>0){
  fputs(str,fp2);//从文件1读字符串并写入文件2
}
```

- fputs函数将**str指向的字符串写入流文件**
  - 操作成功时，函数返回0值
  - 失败返回非零值。

```c
int fputs(char *str,FILE *stream);

FILE *fp1;
char str[128];
//...打开文件
while(scanf("%s",str) != EOF){ //输入Ctrl+Z则结束
  fputs(str,fp); //写入串
  fputs("\n",fp); //写入按Enter键
}
```

#### 4.格式化输入、输出函数fscanf和fprintf

- 对文件的格式化读写就是在上述函数的前面加一个字母f成为fscanf()和fprintf()。其函数调用方式：

```c
int fscanf(FILE *stream,char * format,arg_list);
int fprintf(FILE *stream,char * format,arg_list);
```

![20230320203859](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320203859.png)

#### 5.块读写函数fread和fwrite的使用

- C语言提供**成块的读写方式**来操作文件，使其数组或结构体等类型可以进行一次性读写。其函数的原型分别是：

```c
size_t fread(void *pointer,size_t size,size_t num,FILE*stream);
size_t fwrite(void *pointer,size_t size,size_t num,FILE *stream);
```

- fread**从stream读**
  - 它要求读入
    - 每个元素的大小为size
    - num个数据元素
    - 指针参数pointer应指向接收数据的起始存储位置
- fwrite**写入stream**
  - 函数fwrite**向流stream输出一批数据**
  - 数据的起始位置由指针pointer给定
  - 元素大小是size,共num个
  - 这些数据元素将顺序存入与流stream相关联的文件里。

### 9.2.3 文件指针的定位

![20230320210617](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320210617.png)

### 9.2.4 出错的检测

- 在调用各种输入、输出函数(如fputc、fgetc、fread、fwrite等)时，如果出现错误，除了函数返回值有所反映外，还可以用ferror函数检查。其函数的原型为：

```c
int ferror(FILE* stream);

clearerr(stream); /*重置错误标记并将文件指针置位EOF*/
```

- 如果ferror**返回值为0(假)**,表示文件操作未出错；
- 如果返回一个非0值，则说明文件操作失败

- 应当注意的是，对同一个文件**每一次调用**输入、输出函数，**均产生一个新的ferror函数值**，因此，应当在调用一个输入、输出函数后立即检查ferror函数的值，否则信息会丢失

## 习题

⭐

- 04![20230320212959](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320212959.png)
- 09![20230320213235](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213235.png)
  - w可用于创建新文件
- 01![20230320212733](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320212733.png)
  - 键盘显示器
- 02![20230320212803](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320212803.png)
  - 双反斜线
- 03![20230320212836](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320212836.png)
  - NULL在C就是0
- 05![20230320213041](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213041.png)
- 08![20230320213139](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213139.png)

### 填空题

⭐

- 07![20230320213818](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213818.png)
  - 字节, 流式
- 01![20230320213259](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213259.png)
  - 流文件两种形式
- 05![20230320213700](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213700.png)
  - 文本,二进制
- 06![20230320213744](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320213744.png)
  - 01

## 程序填空题

⭐

- 01 以下程序的功能是将文件file1.c的内容输出到屏幕上并复制到文件file2.c中<image style="height:400px; background-color:#CDDEC2" src="https://raw.githubusercontent.com/Logible/Image/main/note_image/20230320214248.png"/>
- 02以下程序的功能是将文件stud_data中第i个学生的姓名、学号、年龄、性别输出
  - <image style="height:300px; background-color:#CDDEC2" src="https://raw.githubusercontent.com/Logible/Image/main/note_image/20230321100229.png"/>
- 04以下程序从一个二进制文件中读入结构体数据，并把结构体数据显示在屏幕上，![20230321101356](https://raw.githubusercontent.com/Logible/Image/main/note_image/20230321101356.png)
  - read的参数
