# 定时器

JavaScript provides the functions of timing code execution, called timer, which is mainly completed by two functions <code style="color:#ea4335">setTimeout()</code> and <code style="color:#ea4335">setInterval()</code>. They add the timed tasks to the task queue.

## 1.setTimeout()

The <code style="color:#ea4335">setTimeout</code> function is used to specify a certain function or a certain piece of code.

```js
var timerId = setTimeout(func|code, delay);
```

<code style="color:#ea4335">setTimeout</code> function accepts two parameters

- The first parameter <code style="color:#ea4335">func|code</code> is the name of the function or a piece of code to be postponed
- The second parameter <code style="color:#ea4335">delay</code> is the number of milliseconds to postpone the execution.(If omitted, it defaults to 0).

In addtion to the above two parameters, <code style="color:#ea4335">setTimeout</code> also allows more parameters. They will be passed into the delayed function (callback function) in turn.

```js
setTimeout(function (a, b) {
    console.log(a + b);
}, 1000, 1, 1);
//after 1 second output 2
```

Note that if callback function is an method of object, then <code style="color:#ea4335">setTimeout</code> makes the <code style="color:#ea4335">this</code> keyword inside the method point to global environment, instead of the object where it was defined.

```js
var x = 1;

var obj = {
  x: 2,
  y: function () {
    console.log(this.x);
  }
};

setTimeout(obj.y, 1000) // 1
```

To prevent this problem

- One solution is to put obj.y into a function, it makes <code style="color:#ea4335">obj.y</code> execute in the scope of <code style="color:#ea4335">obj</code> instead of executing in the global scope.

```js
var x = 1;

var obj = {
  x: 2,
  y: function () {
    console.log(this.x);
  }
};

setTimeout(function () {
  obj.y();
}, 1000);
// 2
```

- Another solution is use <code style="color:#ea4335">bind</code> method bind the <code style="color:#ea4335">obj.y</code> method to <code style="color:#ea4335">obj</code>

```js
var x = 1;

var obj = {
  x: 2,
  y: function () {
    console.log(this.x);
  }
};

setTimeout(obj.y.bind(obj), 1000)
// 2
```

## 2. setInterval()

The usage of <code style="color:#ea4335">setInterval</code> function is exactly the same as <code style="color:#ea4335">setTimeout</code>, The difference is only that <code style="color:#ea4335">setInterval</code> specifies that a certain task will be executed every once in a while, that is, unlimited timing execution.

The following is an example of implementing web page animation through the <code style="color:#ea4335">setInterval</code> method.

```js
var div = document.getElementById('someDiv');
var opacity = 1;
var fader = setInterval(function() {
  opacity -= 0.1;
  if (opacity >= 0) {
    div.style.opacity = opacity;
  } else {
    clearInterval(fader);
  }
}, 100);
```

The above code every 100 milliseconds, set the transparency of the <code style="color:#ea4335">div</code> element until it is completely transparent.

A common use of <code style="color:#ea4335">setInterval</code> is to implement polling. The following is an example of polling whether the Hash value of the URL has changed.

```js
var hash = window.location.hash;
var hashWatcher = setInterval(function() {
  if (window.location.hash != hash) {
    updatePage();
  }
}, 1000);
```

---
question: what is the window.location.hash

---

<code style="color:#ea4335">setInterval</code> specifies the interval between "start execution", and does not consider the time consumed by each task execution itself So actually, the interval between two executions will less than specified time.

For example, <code style="color:#ea4335">setInterval</code> specifies that it will be executed every 100 milliseconds, it takes 5 milliseconds every 5 milliseconds, then 95 milliseconds after the end of the first execution, the second execution will be started.

To ensure that there is a fixed interval between two executions, you can not use <code style="color:#ea4335">setInterval</code>, but after each execution, use <code style="color:#ea4335">setTimeout</code> to specify the specified time for the next execution.

```js
var i = 1;
var timer = setTimeout(function f() {
  // ...
  timer = setTimeout(f, 2000);
}, 2000);
```
