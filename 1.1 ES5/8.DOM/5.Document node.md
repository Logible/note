# Document node

- [Document node](#document-node)
  - [1. Overview](#1-overview)
  - [2.Property](#2property)
    - [2.1 Shortcut properties](#21-shortcut-properties)
    - [2.2 Node collection properties](#22-node-collection-properties)
    - [2.3 Document static information properties](#23-document-static-information-properties)
    - [2.4 Document status property](#24-document-status-property)
    - [2.5 document.cookie](#25-documentcookie)
    - [2.6 document.designMode](#26-documentdesignmode)
    - [2.7 document.currentScript](#27-documentcurrentscript)
    - [2.8 document.implementation](#28-documentimplementation)
  - [3. method](#3-method)
    - [3.1 document.open(), document.close()](#31-documentopen-documentclose)
    - [3.2 document.write(), document.writeln()](#32-documentwrite-documentwriteln)
    - [3.3 document.querySelector(), document.querySelectorAll()](#33-documentqueryselector-documentqueryselectorall)
    - [3.4 document.getElementsByTagName()](#34-documentgetelementsbytagname)
    - [3.5 document.getElementsByClassName()](#35-documentgetelementsbyclassname)

## 1. Overview

The<code style="color:#ea4335">document</code> node object represents the whole document, each web page has its own <code style="color:#ea4335">document</code> object. The <code style="color:#ea4335">window.document</code> property points to this object. As soon as the browser starts to load the HTML document, the object exists and can be used directly.

There are different ways to obtain the <code style="color:#ea4335">document</code> object.

- For normal web pages, use document or <code style="color:#ea4335">window.document</code> directly.
- The web page in the <code style="color:#ea4335">iframe</code> frame uses the <code style="color:#ea4335">contentDocument</code> property of the <code style="color:#ea4335">iframe</code> node.
- The document returned by the Ajax operation uses the <code style="color:#ea4335">responseXML</code> property of the <code style="color:#ea4335">XMLHttpRequest</code> object.
- The <code style="color:#ea4335">ownerDocument</code> property of the inner node.

The <code style="color:#ea4335">document</code> object inherits <code style="color:#ea4335">EventTarget</code> and <code style="color:#ea4335">Node</code> interface, and mixin the <code style="color:#ea4335">ParentNode</code> interface. This means that the methods of these interfaces can be called on the <code style="color:#ea4335">document</code> object.

In addition, the <code style="color:#ea4335">document</code> has many properties and methods of its own.

## 2.Property

### 2.1 Shortcut properties

The following properties are shortcuts to a node inside the document.

1. document.defaultView

    The <code style="color:#ea4335">document.defaultView</code> property return the <code style="color:#ea4335">window</code> object to which the <code style="color:#ea4335">document</code> object belongs. If the current document does not belong to the <code style="color:#ea4335">window</code> object, this property returns <code style="color:#ea4335">null</code>.

    ```js
    document.defaultView === window // true
    ```

2. document.doctype

    For HTML document, the <code style="color:#ea4335">document</code> object generally has two child nodes:

    - The first child node is <code style="color:#ea4335">document.doctype</code> which points to <code style="color:#ea4335">\<DOCTYPE></code> node, that is Document Type Declaration(Abbreviated DTD) node. The document type node of HTML generally written as <code style="color:#ea4335">\<!DOTYPE html></code>. If the web page does not declare a DTD, this property returns <code style="color:#ea4335">null</code>.

    ```js
    var doctype = document.doctype;
    doctype // "<!DOCTYPE html>"
    doctype.name // "html"
    ```

3. document.documentElement

    The <code style="color:#ea4335">document.documentElement</code> property return the <code style="color:#ea4335">Element</code> that is the root element of the <code style="color:#ea4335">document</code>(for example, the <code style="color:#ea4335">\<html></code> element for HTML documents).

4. document.body, document.head

    The <code style="color:#ea4335">document.body</code> property points to <code style="color:#ea4335">\<body></code> nodes, <code style="color:#ea4335">document.head</code> property points to <code style="color:#ea4335">\<head></code> node.

    These two properties always exist. If the <code style="color:#ea4335">\<head></code> or <code style="color:#ea4335">\<body></code> is omitted from the source code of the webpage, the browser will automatically create it. In addition, these two properties is writable, if rewriting their values, it is equivalent to removing all child nodes.

5. document.srollingElement

    The <code style="color:#ea4335">document.scrolling</code> property returns the scrolling element of the document. In other words, when the document scrolls as a whole, which element is scrolling.

    In standard mode, this property returns the root element of the document <code style="color:#ea4335">document.documentElement</code> (ie <code style="color:#ea4335">\<html></code>). In qurik mode, the <code style="color:#ea4335">\<body></code> is returned. If the element does not exist, <code style="color:#ea4335">null</code> is returned.

    ```js
    // 页面滚动到浏览器顶部
    document.scrollingElement.scrollTop = 0;
    ```

6. document.activeElement

    The <code style="color:#ea4335">document.activeElement</code> property returns the DOM element that has the current focus.

    Generally, this property returns form elements such as <code style="color:#ea4335">\<input></code>, <code style="color:#ea4335">\<textarea></code> and <code style="color:#ea4335">select</code>. If there is currently no focus element, return the <code style="color:#ea4335">\<body></code> element or <code style="color:#ea4335">null</code>.

7. document.fullscreenElement

The <code style="color:#ea4335">document.fullscreenElement</code> property returns the DOM element which currently displayed in fullscreen state. If it is  not in full screen state, <code style="color:#ea4335">null</code> is returned.

```js
if (document.fullscreenElement.nodeName == 'VIDEO') {
  console.log('全屏播放视频');
}
```

In the above code, we can know whether the <code style="color:#ea4335">\<video></code> element is in the full screen state through <code style="color:#ea4335">document.fullscreenElement</code> property.

### 2.2 Node collection properties

The following properties return an instance of <code style="color:#ea4335">HTMLCollection</code> which indicates a collection of specified element within the document. These collections are dymatic, Any changes to the original node will be reflected in the collection immediately.

1. document.links

    The <code style="color:#ea4335">document.links</code> property returns all the <code style="color:#ea4335">\<a></code> and <code style="color:#ea4335">\<area></code> nodes that have the <code style="color:#ea4335">href</code> property set in the current document.

    ```js
    let link = document.links;
    for(let i = 0 ; i < link.length ; i++){
        console.log(link[i]);
    }
    ```

2. document.forms

    <code style="color:#ea4335">document.forms</code> property returns all the <code style="color:#ea4335">form</code> node

    ```js
    var selectForm = document.forms[0];
    ```

    The above code gets the first form of the document.

    In addition to using the position number, the <code style="color:#ea4335">id</code> and <code style="color:#ea4335">name</code> property can also be used to refer to the <code style="color:#ea4335">form</code>

    ```js
    /* HTML 代码如下
    <form name="foo" id="bar"></form>
    */
    document.forms[0] === document.forms.foo // true
    document.forms.bar === document.forms.foo // true
    ```

3. document.images

    The <code style="color:#ea4335">document.images</code> read-only property of the <code style="color:#ea4335">Document</code> interface returns a collection of the <code style="color:#ea4335">images</code> in the current HTML document.

    **Syntax:**

    ```js
    var imageCollection = document.images;
    ```

    **Value:**

    An <code style="color:#ea4335">HTMLCollection</code> providing a live list of all of the images contanined in the current document. Each entry in the colleciton is an <code style="color:#ea4335">HTMLImageElement</code> representing a single image element.

    **Usage notes:**

    You can use either JavaScirpt array notation or the <code style="color:#ea4335">item()</code> method on the returned collection to access the items in the collection. The following are equivalent.

    ```js
    firstImage = imageCollection.item(0);

    firstImage = imageCollection[0];
    ```

4. document.embeds, document.plugins

    The <code style="color:#ea4335">document.embeds</code> property and <code style="color:#ea4335">document.plugins</code> property both return all <code style="color:#ea4335">\<embed></code> nodes.

5. document.scripts

    The <code style="color:#ea4335">document.scirpts</code> property returns all <code style="color:#ea4335">\<script></code> nodes.

    ```js
    var scripts = document.scripts;
    if (scripts.length !== 0 ) {
    console.log('当前网页有脚本');
    }
    ```

6. document.styleSheet

    <code style="color:#ea4335">document.styleSheet</code> property returns a collection of CSS style sheets embedded or introduced in the webpage. For detail, please see the chapter "CSS Operation".

7. summary

    Except for the <code style="color:#ea4335">document.styleSheets</code> property, the other collection properties above all return <code style="color:#ea4335">HTMLCollection</code> instances.

    ```js
    document.links instanceof HTMLCollection // true
    document.images instanceof HTMLCollection // true
    document.forms instanceof HTMLCollection // true
    document.embeds instanceof HTMLCollection // true
    document.scripts instanceof HTMLCollection // true
    
    // HTML 代码如下
    // <form name="myForm">
    document.myForm === document.forms.myForm // true
    ```

---
$\color{#B620E0}{question:}$
why myForm can be obtain by document.myForm???

---

### 2.3 Document static information properties

The following properties return the document imformation.

1. document.documentURL, document.URL

    <code style="color:#ea4335">document.documentURL</code> property and <code style="color:#ea4335">document.URL</code> property both return a string that represents the URL of the current document.

    The difference is that they inherit from different interfaces.

    - <code style="color:#ea4335">documentURL</code> inherits from <code style="color:#ea4335">Document</code> interface, Available for all documents.
    - <code style="color:#ea4335">URL</code> inherits from <code style="color:#ea4335">HTMLCollection</code> interface, can only be used for HTML document.

    ```js
    let documentURL = document.documentURI; // "http://127.0.0.1:5500/"
    let documentDomain = document.domain;// "127.0.0.1"   
    ```

2. document.domain

    The <code style="color:#ea4335">document.domain</code> property returns the domain of the current document which does not include protocol and port.

    If the domain name cannot be obtained, this property returns <code style="color:#ea4335">null</code>

    <code style="color:#ea4335">document.domain</code> is basically a read-only property, except for one case. For web pages with secondary domains, <code style="color:#ea4335">document.domain</code> can be set to the corresponding upper-level domain.

    **For example:**

    The current domain name is <code style="color:#ea4335">a.sub.example.com</code>, and the <code style="color:#ea4335">document.domain</code> property can be set to <code style="color:#ea4335">sub.example.com</code> or <code style="color:#ea4335">example.com</code>. After modifing, two web pages with the same <code style="color:#ea4335">document.domain</code> can read each other's resources, such as the set Cookies.

    In addition, setting <code style="color:#ea4335">document.domain</code> will cause the port to be changed to <code style="color:#ea4335">null</code>. Therefore, if you communicate bt setting <code style="color:#ea4335">document.domain</code>, both of web pages must set this value in order to ensure that the ports are the same.

3. document.location

    The location object is a native object provided by the browser and provides URL-related information and operation methods.

    For a detailed introduction to this object, please see the "Location Object" chapter in the "Browser Model" section.

4. document.lastModified

    The <code style="color:#ea4335">document.lastModified</code> property returns a string that represents the last modification time of the current document. The return value of different browsers, the date format is different

    ```js
    let lastModifiedTime = document.lastModified; 
    //lastModifiedTime: "10/27/2021 12:27:31"
    ```

    Note that the value of the <code style="color:#ea4335">document.lastModified</code> property is string, so it cannot be used directly for comparison. After the <code style="color:#ea4335">Date.parse</code> method turns it into a <code style="color:#ea4335">Date</code> instance to compare two web pages.

    ```js
    var lastVisitedDate = Date.parse('01/01/2018');
    if (Date.parse(document.lastModified) > lastVisitedDate) {
    console.log('网页已经变更');
    }
    ```

    If there is content generated by JavaScript on the page, the return value of <code style="color:#ea4335">document.lastModified</code> property is always the current time.

5. document.title

    <code style="color:#ea4335">document.title</code> property returns the title of the current document. By default, the value of the <code style="color:#ea4335">\<title></code> node is returned. But the property is writable, once it is modified, it will return the modified value.

    ```js
    let documentTile = document.title;
    //documentShit
    ```

6. document.characterSet

    The <code style="color:#ea4335">document.characterSet</code> property return the encoding of current document, such as <code style="color:#ea4335">UTF-8</code>, <code style="color:#ea4335">ISO-8859-1</code> and so on.

7. document.referrer

    The <code style="color:#ea4335">document.referrer</code> property return a string represents the visitors of the current document come from.

    ```js
    document.referrer
    //'https://stackoverflow.com/'
    ```

    If the source cannot be obtained, or the user directly enters the URL instead of clicking through from another web page, <code style="color:#ea4335">document.referrer</code> returns an empty string.

    The value of <code style="color:#ea4335">document.referrer</code> is always consistent with the <code style="color:#ea4335">Referer</code> field of the HTTP header.

8. document.dir

    The <code style="color:#ea4335">document.dir</code> return a string indicating the direction of text. It only has two possible value:

    - <code style="color:#ea4335">rtl</code> means the text is from right to left, Arabic is this way
    - <code style="color:#ea4335">ltr</code> means the text is from left to right

9. document.compatMode

    The <code style="color:#ea4335">compatMode</code> property returns the mode in which the browser processes the document.

    The possible values are <code style="color:#ea4335">BackCompat</code>(backward compatibility mode) and <code style="color:#ea4335">CSS1Compat</code>(strict mode)

    Generally speaking, if a clear <code style="color:#ea4335">DOCTYPE</code>(such as <code style="color:#ea4335">\<!doctype html></code>),the value of <code style="color:#ea4335">document.compatMode</code> is <code style="color:#ea4335">CSS1Compat</code>

### 2.4 Document status property

1. document.hidden

    The <code style="color:#ea4335">document.hidden</code> property return a Boolean value indicating whether the current page is visible.

    The following is the situations that the <code style="color:#ea4335">document.hidden</code> returns <code style="color:#ea4335">true</code>. This property is introduced by the Page Visibility API and is generally used in conjunction with this API.

2. document.visibilityState

    The <code style="color:#ea4335">document.visibilityState</code> returns the visibility of the document.

    Possible values are:

    - <code style="color:#ea4335">visible</code>: The page content may be at least partially visible. In practice this means that the page is the foreground tab of a non-minimized window.
    - <code style="color:#ea4335">hidden</code>: The page content is not visible to the user. In practice this means that the document is either a background tab or part of a minimized windows, or the OS screen lock is active.
    - <code style="color:#ea4335">prerender</code>: The page content is being prerendered and is not visible to the user(considered hidden for purposes of<code style="color:#ea4335">document.hidden</code>). The document may start in this state, but will never transition to it from another value.
    - Note: This was removed from the standard.

    **Syntax:**

    ```js
    var string = document.visibilityState
    ```

    **Examples:**

    ```js
    document.addEventListener("visibilitychange", function() {
    console.log( document.visibilityState );
    // Modify behavior...
    })
    ```

    ---
    $\color{#B620E0}{question:}$

    The usage of addEventListener

    ---

    Typical use of this can be to prevent the download of some assets when the document is solely prerendered, or stop some activities when the document is in the background or minimized.

3. document.readyState

The <code style="color:#ea4335">document.readyState</code> property describes the loading state of the <code style="color:#ea4335">document</code>

when the value of this property changes, a <code style="color:#ea4335">readystatechange</code> event fires on the <code style="color:#ea4335">document</code> object.

**Syntax:**

```js
let string = document.readyState;
```

**Values:**

The <code style="color:#ea4335">readyState</code> of a document can be one of following:

- loading: The <code style="color:#ea4335">document</code> still loading.
- interactive: The document has finished loading and the document has been parsed but sub-resources such as scirpt, images, stylesheets and frames are still loading.
- complete: The document and all sub-resourses have finished loading. The state indicates that the <code style="color:#ea4335">load</code> event is about to fire.

**Examples:**

<code style="color:#ea4335">readystatechange</code> as event listener to insert or modify the DOM before DOMContentLoaded.

```js
document.addEventListener('readystatechange', event => {
  if (event.target.readyState === 'interactive') {
    initLoader();
  }
  else if (event.target.readyState === 'complete') {
    initApp();
  }
});
```

### 2.5 document.cookie

The <code style="color:#ea4335">document.cookie</code> property is used to manipulate browser cookies. For details, see the "Cookie" chapter of the "Browser Model" section.

### 2.6 document.designMode

The <code style="color:#ea4335">document.designMode</code> property controls whether the current document is editable. This property only has two value <code style="color:#ea4335">on</code> and <code style="color:#ea4335">off</code>. Once set to on, the user can edit the content of the entire document.

**Stytax:**

```js
var mode = document.designMode;
document.designMode = value;
```

**Example:**

```js
// HTML 代码如下
// <iframe id="editor" src="about:blank"></iframe>
var editor = document.getElementById('editor');
editor.contentDocument.designMode = 'on';
```

### 2.7 document.currentScript

The <code style="color:#ea4335">documentcurrentScirpt</code> property returns the <code style="color:#ea4335">\<scirpt></code> element whose scirpt is currently being processed and isn't a JavaScirpt module.

**Syntax:**

```js
var curScriptElement = document.currentScript;
```

**Example:**

```js
if (document.currentScript.async) {
console.log("Executing asynchronously");
} else {
console.log("Executing synchronously");
}
```

It's important to note that this will not referencethe <code style="color:#ea4335">\<scirpt></code>element if the code in the script is being called as a callback or event handler; it will only reference element while it's initially being processed

### 2.8 document.implementation

The <code style="color:#ea4335">document.implementation</code> property return a <code style="color:#ea4335">DOMIplementation</code> object. The object has three methods, mainly used to create a new Document object independent of the current document.

The following is an instance of creating HTML document.

```js
var doc = document.implementation.createHTMLDocument('Title');
var p = doc.createElement('p');
p.innerHTML = 'hello world';
doc.body.appendChild(p);

document.replaceChild(
  doc.documentElement,
  document.documentElement
);
```

In the above code, the first step is to generate a new HTML document <code style="color:#ea4335">doc</code>, and then replace <code style="color:#ea4335">document.documentElement</code> with its root element <code style="color:#ea4335">document.documentElement</code>. This will make the contents of the current document disappear and become <code style="color:#ea4335">hello world</code>.

## 3. method

### 3.1 document.open(), document.close()

<code style="color:#ea4335">document.open</code> method clears all the contents of the current document, making the document in a writable status. For the <code style="color:#ea4335">document.write()</code> method to write content.

The <code style="color:#ea4335">document.close</code> method is used to close the document opened by <code style="color:#ea4335">document.open()</code>

```js
document.open();
document.write('hello world');
document.close();
```

### 3.2 document.write(), document.writeln()

The <code style="color:#ea4335">document.write()</code> method writes a string of text to a document stream opened by <code style="color:#ea4335">document.open()</code>

Note:

Because <code style="color:#ea4335">document.write()</code> writes to the document stream, calling <code style="color:#ea4335">document.wirte()</code> on a closed (loaded) document automatically calls <code style="color:#ea4335">document.open()</code>, which clear the document.

**Syntax:**

```js
document.write(markup);
```

**Parameters:**

**markup:**

A string containing the text to be written to the document.

**Example:**

```js
<html>

<head>
  <title>Write example</title>

  <script>
    function newContent() {
      document.open();
      document.write("<h1>Out with the old, in with the new!</h1>");
      document.close();
    }
  </script>
</head>

<body onload="newContent();">
  <p>Some original document content.</p>
</body>

</html>
```

If the <code style="color:#ea4335">document.wirte()</code> call is embedded within an inline HTML <code style="color:#ea4335">\<scirpt></code> tag, then it will not call <code style="color:#ea4335">document.open()</code>. For example

```js
<script>
  document.write("<h1>Main title</h1>")
</script>
```

The <code style="color:#ea4335">document.write</code> is a method that existed before JavaScirpt language standardization. Now there is a more standard way to write content to the document(such as assigning a vlaue the <code style="color:#ea4335">innerHTML</code> property)

The <code style="color:#ea4335">document.writenln</code> method is exactly the same as the write method, In addition to adding a newline character at the end of the output.

```js
document.write(1);
document.write(2);
// 12

document.writeln(1);
document.writeln(2);
// 1
// 2
//
```

Note that the writeln method adds a newline character in ASCLL code. It doesn't work when rendered as HTML page.

### 3.3 document.querySelector(), document.querySelectorAll()

- The <code style="color:#ea4335">document.querySelector</code> method accepts a CSS selector as a parameter and retruns the element node that matches the selector.
  - If there are multiple nodes that meet the matching conditions, the first matching nodesi returned.
  - If no matching node is found, <code style="color:#ea4335">null</code> is returned.
- The <code style="color:#ea4335">document.querySelectorAll</code> method is similar to <code style="color:#ea4335">querySelector usage</code>, the difference is that it returns a NodeList object.

**Syntax:**

```js
element = document.querySelector(selectors);
```

**Parameters:**

selectors

A DOMString containing one or more selectors to match. This string must be a valid CSS selector string; if it isn't, a <code style="color:#ea4335">SyntaxError</code> excpetion is thrown.

```js
var el1 = document.querySelector('.myclass');

let le1 = document.querySelectorAll('.shits');
/**
 * le1: NodeList(2)
 * 0: div#shits.shits
 * 1: div#mydiv.shits
 */
```

---
$\color{#B620E0}{to be studied}$

Complex CSS selectors

---

### 3.4 document.getElementsByTagName()

The <code style="color:#ea4335">Element.getElementsByTagName()</code> method returns a live <code style="color:#ea4335">HTMLCollection</code> of elements with the given <code style="color:#ea4335">tagName</code>

All descendants of the specified element are searched, but not the element itself. The return is live, which means it updates inself with the DOM tree automatically.

**Syntax:**

```js
elements = element.getElementsByTagName(tagName)
```

- <code style="color:#ea4335">elements</code> is a live <code style="color:#ea4335">HTMLCollection</code> of elements with a matching tag name, in the order they appear. If no elements are found, the <code style="color:#ea4335">HTMLCollection</code> is emplty
- <code style="color:#ea4335">elements</code> is the element from where tghe search starts. Only the element's descendants are included, not the element itself.
- <code style="color:#ea4335">tagName</code> is the qualified name to look for. The special string <code style="color:#ea4335">*</code> represents all elements. For compatibility with XHTML, lower-case should be used.(HTML tag names are not case sensetive)

```js
const shit = document.getElementById('shits');
const shits = shit.getElementsByTagName('div');
/**
 * 0: div#shitdiv.shitdiv
 * 1: div#mydiv.shits
 * 2: div
 */
```

### 3.5 document.getElementsByClassName()

The <code style="color:#ea4335">document.getElementsByClassName()</code> method return an array-like obejct.(a <code style="color:#ea4335">HTLMCollection</code> instance). All elements whose class names meet the specified conditions are included, and the changes of the elements are reflected in the returned results in real time.

**Syntax:**

```js
var elements = document.getElementsByClassName(names); // or:
var elements = rootElement.getElementsByClassName(names);
```

Since <code style="color:#ea4335">class</code> is a reserved word, JavaScirpt always uses <code style="color:#ea4335">className</code> to represent the class of CSS.

Note that in normal mode, the CSS class is case sensitive. (In quirks mode, case is not sensitive.)

Like the <code style="color:#ea4335">getElementByTagName()</code> method, the <code style="color:#ea4335">getElementByClassName()</code> can be called not only on the document obejct, but also on any element node.
