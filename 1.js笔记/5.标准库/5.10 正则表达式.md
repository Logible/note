# 正则表达式

- [正则表达式](#正则表达式)
  - [1.概述](#1概述)
  - [2.实例属性](#2实例属性)
    - [3.实例方法](#3实例方法)
  - [4.字符串的实例方法](#4字符串的实例方法)
    - [4.1 String.prototype.match()](#41-stringprototypematch)
    - [4.2 Stirng.prototype.search()](#42-stirngprototypesearch)
    - [4.3 String.prototype.replace()](#43-stringprototypereplace)

## 1.概述

正则表达式(regular expression)是一种表达文本模式(即字符串结构)的方法,有点像字符串的模板,常用来按照"给定模式"匹配文本.

比如,正则表达式给出一个Email地址的模式,然后用它来确定一个字符串是否为Eamil地址

新建正则表达式有两种方法

- 一种是使用字面量,以斜杠表示开始和结束
- 一种是使用$\color{#ea4335}{RegExp}$构造函数

- $\color{#ea4335}{RegExp}$构造函数还可以接受第二个参数,表示修饰符

```js
var regex = /xyz/;

var regex = new RegExp('xyz');

var regex = new RegExp('xyz', 'i');
// 等价于
var regex = /xyz/i;
```

上面两种写法是等价的,都新建了一个内容为$\color{#ea4335}{xyz}$的正则表达式对象

区别

- 第一种方法在引擎编译代码时,就会新建正则表达式
- 第二种方法在运行时新建正则表达式

所以前者的效率比后者高

$\color{#B620E0}{编译和运行-番外篇3}$

## 2.实例属性

正则对象的实例属性分为两类

1. 一类是修饰符相关,用于了解设置了什么修饰符

    - $\color{#ea4335}{RegExp.prototype.ignoreCase}$:返回一个布尔值，表示是否设置了i修饰符。
    - $\color{#ea4335}{RegExp.prototype.global}$:返回一个布尔值，表示是否设置了g修饰符。
    - $\color{#ea4335}{RegExp.prototype.multiline}$:返回一个布尔值，表示是否设置了m修饰符。
    - $\color{#ea4335}{RegExp.prototype.flags}$:返回一个字符串，包含了已经设置的所有修饰符，按字母排序。

    ```js
    var r = /abc/igm;

    r.ignoreCase // true
    r.global // true
    r.multiline // true
    r.flags // 'gim'
    ```

2. 一类与修饰符无关

   - $\color{#ea4335}{RegExp.prototype.lastIndex}$：返回一个整数，表示下一次开始搜索的位置。该属性可读写，但是只在进行连续搜索时有意义
   - $\color{#ea4335}{RegExp.prototype.source}$：返回正则表达式的字符串形式（不包括反斜杠），该属性只读。

   ```js
   var r = /shit/igm;

   console.log(r.lastIndex);//0
   console.log(r.source);//shit
   ```

### 3.实例方法

1. RegExp.prototype.test()

    正则实例对象的$\color{#ea4335}{test}$方法返回一个布尔值,表示当前模式是否能够匹配是参数字符串

    ```js
    /cat/.test('cats and dogs') // true
    ```

    $\color{#ea4335}{g}$修饰符:每一次$\color{#ea4335}{test}$方都从上一次结束的位置开始向后匹配

    ```js
    var r = /x/g;
    var s = '_x_x';

    r.lastIndex // 0
    r.test(s) // true

    r.lastIndex // 2
    r.test(s) // true

    r.lastIndex // 4
    r.test(s) // false
    ```

    带有$\color{#ea4335}{g}$修饰符时,可以通过正则对象的$\color{#ea4335}{lastIndex}$属性指定开始搜索的位置

    ```js
    var r = /x/g;
    var s = '_x_x';

    r.lastIndex = 4;
    r.test(s) // false

    r.lastIndex // 0
    r.test(s)
    ```

    $\color{#fbbc05}{Tips:}$

    - 带有$\color{#ea4335}{g}$修饰符时,正则表达式内部会记住上一次的$\color{#ea4335}{lastIndex}$属性,这时候不应该更换所要匹配的字符串,否则会有一些难以察觉的错误
    - $\color{#ea4335}{lastIndex}$属性只对同一个正则表达式有效,下述代码会导致无限循环

    ```js
    var r = /bb/g;
    r.test('bb') // true
    r.test('-bb-') // false

    var count = 0;
    while (/a/g.test('babaa')) count++;
    ```

    若正则模式是一个空字符串,则匹配所有字符串

    ```js
    new RegExp('').test('abc')
    // true
    ```

2. RegExp.prototype.exec()

    正则实例对象的$\color{#ea4335}{exec()}$方法,用来返回匹配结果

    - 若发现匹配,返回一个数组
    - 成员是匹配成功的字符串
    - 包含以下两个属性
        - $\color{#ea4335}{input}$:整个原字符串
        - $\color{#ea4335}{index}$:模式匹配成功的开始位置
    - 若无匹配,返回null

    ```js
    var s = '_x_x';
    var r1 = /x/;
    var r2 = /y/;

    r1.exec(s) // ["x"]
    r2.exec(s) // null
    ```

    如果正则表达式包括圆括号(即含有"组匹配"),则返回的数组会包括多个成员

    - 第一个成员是整个匹配成功的结果
    - 第二成员对应第一个括号
    - 第三成员对应第二个括号

    以此类推,整个数组的$\color{#ea4335}{length}$属性等于组匹配的数量再加1

    ```js
    var s = '_x_x';
    var r = /_(x)/;

    r.exec(s) // ["_x", "x"]
    ```

    利用$\color{#ea4335}{g}$修饰符允许多次匹配的特点,可以用一个循环完成全部匹配

    ```js
    var reg = /a/g;
    var str = 'abc_abc_abc'

    while(true) {
    var match = reg.exec(str);
    if (!match) break;
    console.log('#' + match.index + ':' + match[0]);
    }

    // #0:a
    // #4:a
    // #8:a
    ```

## 4.字符串的实例方法

字符串的实例方法之中,有四个实例方法与正则表达式有关

- $\color{#ea4335}{String.prototype.match();}$
- $\color{#ea4335}{String.prototype.search();}$
- $\color{#ea4335}{String.prototype.replace();}$
- $\color{#ea4335}{String.prototype.split();}$

### 4.1 String.prototype.match()

字符串实例对象的$\color{#ea4335}{match}$方法对字符串进行正则匹配,返回匹配结果

如果正则表达式带有$\color{#ea4335}{g}$修饰符,则该方法与正则对象的$\color{#ea4335}{exec}$方法行为不同,会一次性返回所有匹配成功的结果

```js
var string = 'holyshit bullshit shitstirrer';
var regular = /shit/g;
var array1 = string.match(regular);
var array2 = regular.exec(string);

console.log(array1);
/**
0: "shit"
1: "shit"
2: "shit"
length: 3
 */
console.log(array2);
/**
0: "shit"
groups: undefined
index: 4
input: "holyshit bullshit shitstirrer"

*/
```

设置正则表达式的$\color{#ea4335}{lastIndex}$属性,对$\color{#ea4335}{match}$方法无效,匹配总是从字符串的第一个字符开始

```js
var r = /a|b/g;
r.lastIndex = 7;
'xaxb'.match(r) // ['a', 'b']
r.lastIndex // 0
```

### 4.2 Stirng.prototype.search()

字符串对象的$\color{#ea4335}{search}$方法,返回第一个满足条件的匹配结果在整个字符串中的位置. 如果没有任何匹配,则返回$\color{#ea4335}{-1}$

```js
var string = '_x_x_shit_shit2';
var index = string.search(/shit/g);
console.log(index);
```

### 4.3 String.prototype.replace()

字符串对象的$\color{#ea4335}{replace}$方法可以替换匹配的值. 它接受两个参数,第一个是正则表达式,表示搜索模式,第二个是替换的内容

```js
str.replace(search, replacement)
```
