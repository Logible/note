# Classçš„åŸºæœ¬è¯­æ³•

- [Classçš„åŸºæœ¬è¯­æ³•](#classçš„åŸºæœ¬è¯­æ³•)
  - [1.ç®€ä»‹](#1ç®€ä»‹)
    - [1.1 ç±»çš„ç”±æ¥](#11-ç±»çš„ç”±æ¥)
    - [1.2 constructoræ–¹æ³•](#12-constructoræ–¹æ³•)
    - [1.3 ç±»çš„å®ä¾‹](#13-ç±»çš„å®ä¾‹)
    - [1.4 getter and setter](#14-getter-and-setter)
    - [1.5 å±æ€§è¡¨è¾¾å¼](#15-å±æ€§è¡¨è¾¾å¼)
    - [1.6 Classè¡¨è¾¾å¼](#16-classè¡¨è¾¾å¼)
    - [1.7 æ³¨æ„ç‚¹](#17-æ³¨æ„ç‚¹)
  - [2.é™æ€æ–¹æ³•](#2é™æ€æ–¹æ³•)
  - [3.å®ä¾‹å±æ€§çš„æ–°å†™æ³•](#3å®ä¾‹å±æ€§çš„æ–°å†™æ³•)
  - [4.é™æ€å±æ€§](#4é™æ€å±æ€§)
  - [5. ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§](#5-ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§)
    - [5.1 ç°æœ‰çš„è§£å†³æ–¹æ¡ˆ](#51-ç°æœ‰çš„è§£å†³æ–¹æ¡ˆ)
    - [5.2 ç§æœ‰å±æ€§çš„ææ¡ˆ](#52-ç§æœ‰å±æ€§çš„ææ¡ˆ)
    - [5.3 è¿ç®—ç¬¦](#53-è¿ç®—ç¬¦)
  - [6.é™æ€å—](#6é™æ€å—)

## 1.ç®€ä»‹

### 1.1 ç±»çš„ç”±æ¥

JavaScriptè¯­è¨€ä¸­ï¼Œç”Ÿæˆå®ä¾‹å¯¹è±¡çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯é€šè¿‡æ„é€ å‡½æ•°

```js
function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.toString = function () {
  return '(' + this.x + ', ' + this.y + ')';
};

var p = new Point(1, 2);
```

è€ŒES6æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿè¯­è¨€çš„å†™æ³•,å¼•å…¥äº†Classæ¦‚å¿µ,ä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿,é€šè¿‡<code style="color:#ea4335">class</code>å…³é”®å­—,å¯ä»¥å®šä¹‰ç±»

```js
class Point {
    constructor(x, y) {
        this.x = x;
        this.y = y;
    }

    toString(){
        return '(' + this.x + ', ' + this.y + ')';
    }
}


typeof Point // "function"
Point === Point.prototype.constructor // true

let point1 = new Point(1,2);//(1,2)
console.log(point1.toString());
```

- è¿™ç§å†™æ³•ä¸å¼€å¤´æ„é€ å‡½æ•°<code style="color:#ea4335">Ponit</code>æ˜¯ä¸€è‡´çš„
- ç±»çš„æ•°æ®ç±»å‹å°±æ˜¯å‡½æ•°,ç±»æœ¬èº«å°±æŒ‡å‘æ„é€ å‡½æ•°
- ä½¿ç”¨çš„æ—¶å€™,ä¹Ÿæ˜¯ç›´æ¥å¯¹ç±»ä½¿ç”¨<code style="color:#ea4335">new</code>å‘½ä»¤,è·Ÿæ„é€ å‡½æ•°çš„ç”¨æ³•å®Œå…¨ä¸€è‡´

æ„é€ å‡½æ•°çš„<code style="color:#ea4335">prototype</code>å±æ€§,åœ¨ES6çš„"ç±»"ä¸Šç»§ç»­å­˜åœ¨

```js
class Point {
  constructor() {
    // ...
  }

  toString() {
    // ...
  }

  toValue() {
    // ...
  }
}

// ç­‰åŒäº

Point.prototype = {
  constructor() {},
  toString() {},
  toValue() {},
};
```

ç”±äºç±»çš„æ–¹æ³•éƒ½å®šä¹‰åœ¨<code style="color:#ea4335">prototype</code>å¯¹è±¡ä¸Šé¢,æ‰€ä»¥ç±»çš„æ–°æ–¹æ³•å¯ä»¥æ·»åŠ åœ¨<code style="color:#ea4335">prototype</code>å¯¹è±¡ä¸Šé¢.

<code style="color:#ea4335">Object.assign()</code>æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸€æ¬¡å‘ç±»æ·»åŠ å¤šä¸ªæ–¹æ³•

```js
Object.assign(Point.prototype, {
    toShit(){
        console.log("why invoke me? you this piece of shit");
    },
    toShit2(){}
  });

let point1 = new Point(1,2);
point1.toShit();
```

ç±»å’ŒES5è¡Œä¸ºä¸ä¸€è‡´çš„ç‚¹:

- ç±»çš„å†…éƒ¨æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•,éƒ½æ˜¯ä¸å¯æšä¸¾çš„(non-enumerable)
- ES5æ„é€ å‡½æ•°å†…éƒ¨å®šä¹‰çš„æ–¹æ³•æ˜¯å¯æšä¸¾çš„

```js
class Point {
  constructor(x, y) {
    // ...
  }
  toString() {
    // ...
  }
}
Object.keys(Point.prototype)
// []
Object.getOwnPropertyNames(Point.prototype)
// ["constructor","toString"]


var Point = function (x, y) {
  // ...
};
Point.prototype.toString = function () {
  // ...
};
Object.keys(Point.prototype)
// ["toString"]
Object.getOwnPropertyNames(Point.prototype)
// ["constructor","toString"]
```

### 1.2 constructoræ–¹æ³•

<code style="color:#ea4335">constructor()</code>æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•,é€šè¿‡<code style="color:#ea4335">new</code>å‘½ä»¤ç”Ÿæˆå¯¹è±¡å®ä¾‹æ—¶,è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•. ä¸€ä¸ªç±»å¿…é¡»æœ‰<code style="color:#ea4335">constructor()</code>æ–¹æ³•,è‹¥æ²¡æœ‰æ˜¾ç¤ºå®šä¹‰,ä¸€ä¸ªç©ºçš„<code style="color:#ea4335">constructor()</code>æ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ 

```js
class Point {
}

// ç­‰åŒäº
class Point {
  constructor() {}
}
```

<code style="color:#ea4335">constructor()</code>å‡½æ•°é»˜è®¤è¿”å›å®ä¾‹å¯¹è±¡(å³<code style="color:#ea4335">this</code>),å®Œå…¨å¯ä»¥æŒ‡å®šè¿”å›çš„å¦å¤–ä¸€ä¸ªå¯¹è±¡

```js
class Foo {
  constructor() {
    return Object.create(null);
  }
}

new Foo() instanceof Foo
// false
```

ç±»è·Ÿæ™®é€šå‡½æ•°çš„å¦ä¸€ä¸ªåŒºåˆ«:

ç±»å¿…é¡»ä½¿ç”¨<code style="color:#ea4335">new</code>æ‰å¯ä»¥æ‰§è¡Œ,åè€…ä¸ç”¨<code style="color:#ea4335">new</code>ä¹Ÿå¯ä»¥æ‰§è¡Œ

```js
class Foo {
  constructor() {
    return Object.create(null);
  }
}

Foo()
/**
  Uncaught TypeError: Class constructor Foo cannot be invoked without 'new'
 */
```

### 1.3 ç±»çš„å®ä¾‹

ä¸ES5ç›¸åŒ,å®ä¾‹çš„å±æ€§é™¤éå®šä¹‰åœ¨å…¶æœ¬èº«(å³å®šä¹‰åœ¨<code style="color:#ea4335">this</code>å¯¹è±¡ä¸Š),å¦åˆ™éƒ½æ˜¯å®šä¹‰åœ¨åŸå‹ä¸Š(å³å®šä¹‰åœ¨<code style="color:#ea4335">class</code>ä¸Š)

```js
//å®šä¹‰ç±»
class Point {

  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  toString() {
    return '(' + this.x + ', ' + this.y + ')';
  }

}

var point = new Point(2, 3);

point.toString() // (2, 3)

point.hasOwnProperty('x') // true
point.hasOwnProperty('y') // true
point.hasOwnProperty('toString') // false
point.__proto__.hasOwnProperty('toString') // true
```

ä¸ES5ç›¸åŒ,ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å¯¹è±¡

```js
var p1 = new Point(2,3);
var p2 = new Point(3,2);

p1.__proto__ === p2.__proto__
//true
```

  <code style="color:#ea4335">\_\_proto\_\_</code>å±æ€§å¹¶ä¸æ˜¯è¯­è¨€æœ¬èº«çš„ç‰¹æ€§,è€Œæ˜¯å„å¤§å‚å•†å®ç°æ—¶æ·»åŠ çš„ç§æœ‰å±æ€§,æ•…ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¯¥å±æ€§, é¿å…å¯¹ç¯å¢ƒäº§ç”Ÿä¾èµ–. ç”Ÿäº§ç¯å¢ƒä¸­,å¯ä»¥ç”¨<code style="color:#ea4335">Object.getPrototypeOf</code>æ–¹æ³•æ¥è·å–å®ä¾‹å¯¹è±¡çš„åŸå‹,ç„¶åå†ä¸ºåŸå‹æ·»åŠ æ–¹æ³•/å±æ€§

```js
var p1 = new Point(2,3);
var p2 = new Point(3,2);

p1.__proto__.printName = function () { return 'Oops' };

p1.printName() // "Oops"
p2.printName() // "Oops"

var p3 = new Point(4,2);
p3.printName() // "Oops"
```

ğŸ‘†æ˜¯æ”¹å˜"ç±»"çš„åŸå§‹å®šä¹‰çš„ä¾‹å­

### 1.4 getter and setter

ä¸ES5ä¸€æ ·,åœ¨"ç±»"çš„å†…éƒ¨å¯ä»¥ä½¿ç”¨<code style="color:#ea4335">get</code>å’Œ<code style="color:#ea4335">set</code>å…³é”®å­—,å¯¹æŸä¸ªå±æ€§è®¾ç½®å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°,æ‹¦æˆªè¯¥å±æ€§çš„å­˜å–è¡Œä¸º

ğŸ‘‡ä»£ç ä¸­,<code style="color:#ea4335">prop</code>å±æ€§æœ‰å¯¹åº”çš„å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°,å› æ­¤å¤åˆ¶å’Œè¯»å–è¡Œä¸ºéƒ½è¢«è‡ªå®šä¹‰äº†

```js
class MyClass {
  constructor() {
    // ...
  }
  get prop() {
    return 'getter';
  }
  set prop(value) {
    console.log('setter: '+value);
  }
}

let inst = new MyClass();

inst.prop = 123;
// setter: 123

inst.prop
// 'getter'
```

å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°æ˜¯è®¾ç½®åœ¨å±æ€§çš„Descriptionå¯¹è±¡ä¸Šçš„

```js
class CustomHTMLElement {
  constructor(element) {
    this.element = element;
  }

  get html() {
    return this.element.innerHTML;
  }

  set html(value) {
    this.element.innerHTML = value;
  }
}

var descriptor = Object.getOwnPropertyDescriptor(
  CustomHTMLElement.prototype, "html"
);

console.table(descriptor);
```

ğŸ‘†![20211007215316](https://raw.githubusercontent.com/Logible/Image/main/note_image/20211007215316.png)

### 1.5 å±æ€§è¡¨è¾¾å¼

ç±»çš„å±æ€§å,å¯ä»¥é‡‡ç”¨è¡¨è¾¾å¼

```js
let methodName = 'getArea';

class Square {
  constructor(length) {
    // ...
  }

  [methodName]() {
    // ...
  }
}
```

### 1.6 Classè¡¨è¾¾å¼

ä¸å‡½æ•°ä¸€æ ·,ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼çš„å½¢å¼å®šä¹‰

```js
const MyClass = class Me {
  getClassName() {
    return Me.name;
  }
};
```

è¿™ä¸ªç±»çš„åå­—æ˜¯<code style="color:#ea4335">Me</code>,ä½†æ˜¯<code style="color:#ea4335">Me</code>åªåœ¨Classå†…éƒ¨å¯ç”¨,æŒ‡ä»£å½“å‰ç±»,åœ¨Classå¤–éƒ¨,è¿™ä¸ªç±»åªèƒ½ç”¨<code style="color:#ea4335">MyClass</code>å¼•ç”¨(æ•…å¯ä»¥çœç•¥<code style="color:#ea4335">Me</code>)

```js
let inst = new MyClass();
inst.getClassName() // Me
Me.name // ReferenceError: Me is not defined
```

é‡‡ç”¨<code style="color:#ea4335">Class</code>è¡¨è¾¾å¼,å¯ä»¥å†™å‡ºç«‹å³æ‰§è¡Œçš„Class

```js
let person = new class{
    constructor(name){
        this.name = name;
    }

    sayNmae(){
        console.log("My name is FuckYou",this.name);
    }
}('å§“å¼ åä¸‰');

person.sayNmae();    
```

### 1.7 æ³¨æ„ç‚¹

1. ä¸¥æ ¼æ¨¡å¼

    ç±»å’Œæ¨¡å—çš„å†…éƒ¨,é»˜è®¤å°±æ˜¯ä¸¥æ ¼æ¨¡å¼,æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨<code style="color:#ea4335">use strict</code>æŒ‡å®šè¿è¡Œæ¨¡å¼

    åªè¦ä»£ç å†™åœ¨ç±»/æ¨¡å—,å°±åªæœ‰ä¸¥æ ¼æ¨¡å¼å¯ç”¨

    è€ƒè™‘åˆ°æœªæ¥æ‰€æœ‰çš„ä»£ç å…¶å®éƒ½æ˜¯è¿è¡Œåœ¨æ¨¡å—ä¹‹ä¸­,æ‰€ä»¥ES6å®é™…ä¸ŠæŠŠæ•´ä¸ªè¯­è¨€å‡çº§åˆ°äº†ä¸¥æ ¼æ¨¡å¼

2. ä¸å­˜åœ¨æå‡

    ç±»ä¸å­˜åœ¨å˜é‡æå‡(hoist),è¿™ä¸€ç‚¹ä¸ES5å®Œå…¨ä¸åŒ

    - <code style="color:#ea4335">Foo</code>ç±»ä½¿ç”¨åœ¨å‰,å®šä¹‰åœ¨å,è¿™æ ·ä¼šæŠ¥é”™,å› ä¸ºES6ä¸ä¼šæŠŠç±»çš„å£°æ˜æå‡åˆ°ä»£ç å¤´éƒ¨
    - å­ç±»å¿…é¡»åœ¨çˆ¶ç±»ä¹‹åå®šä¹‰,è‹¥å­˜åœ¨<code style="color:#ea4335">class</code>çš„æå‡,ä¸Šé¢ä»£ç å°±ä¼šæŠ¥é”™,å› ä¸º<code style="color:#ea4335">class</code>ä¼šè¢«æå‡åˆ°ä»£ç å¤´éƒ¨,è€Œ<code style="color:#ea4335">let</code>å‘½ä»¤æ˜¯ä¸æå‡çš„,å¯¼è‡´<code style="color:#ea4335">Bar</code>ç»§æ‰¿<code style="color:#ea4335">Foo</code>çš„æ—¶å€™,<code style="color:#ea4335">Foo</code>å°šæœªå®šä¹‰

    ```js
    new Foo(); // ReferenceError
    class Foo {}

    {
      let Foo = class {};
      class Bar extends Foo {
      }
    }
    ```

3. nameå±æ€§

    ç”±äºæœ¬è´¨ä¸Š,ES6çš„ç±»åªæ˜¯ES5çš„æ„é€ å‡½æ•°çš„ä¸€å±‚åŒ…è£…,æ‰€ä»¥å‡½æ•°çš„è®¸å¤šç‰¹æ€§éƒ½è¢«<code style="color:#ea4335">Class</code>ç»§æ‰¿,åŒ…æ‹¬<code style="color:#ea4335">name</code>å±æ€§

    ```js
    class Point {}
    Point.name // "Point"
    ```

4. Generatoræ–¹æ³•

    å¾…å­¦

5. thisçš„æŒ‡å‘

    å¾…å­¦

## 2.é™æ€æ–¹æ³•

è‹¥åœ¨ä¸€ä¸ªæ–¹æ³•å‰,åŠ ä¸Š<code style="color:#ea4335">static</code>å…³é”®å­—,å°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿,è€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨,è¿™å°±ç§°ä¸º"é™æ€æ–¹æ³•"

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

Foo.classMethod() // 'hello'

var foo = new Foo();
foo.classMethod()
// TypeError: foo.classMethod is not a function
```

è‹¥é™æ€æ–¹æ³•ä¸­åŒ…å«<code style="color:#ea4335">this</code>å…³é”®å­—,æ•´ä¸ª<code style="color:#ea4335">this</code>æŒ‡çš„æ˜¯ç±»,è€Œä¸æ˜¯å®ä¾‹

```js
class Foo {
  static bar() {
    this.baz();
  }
  static baz() {
    console.log('hello');
  }
  baz() {
    console.log('world');
  }
}

Foo.bar() // hello
```

ğŸ‘†ä¸Šé¢ä»£ç ä¸­ï¼Œé™æ€æ–¹æ³•<code style="color:#ea4335">bar</code>è°ƒç”¨äº†<code style="color:#ea4335">this.baz</code>,è¿™é‡Œçš„<code style="color:#ea4335">this</code>æŒ‡çš„æ˜¯<code style="color:#ea4335">Foo</code>ç±»ï¼Œè€Œä¸æ˜¯<code style="color:#ea4335">Foo</code>çš„å®ä¾‹ã€‚ç­‰åŒäºè°ƒç”¨<code style="color:#ea4335">Foo.baz</code>

è¿˜å¯ä»¥çœ‹å‡º,é™æ€æ–¹æ³•å¯ä»¥ä¸éé™æ€æ–¹æ³•é‡å

çˆ¶ç±»çš„é™æ€æ–¹æ³•,å¯ä»¥è¢«å­ç±»ç»§æ‰¿

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

class Bar extends Foo {
}

Bar.classMethod() // 'hello'
```

é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥ä»<code style="color:#ea4335">super</code>å¯¹è±¡ä¸Šè°ƒç”¨

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

class Bar extends Foo {
  static classMethod() {
    return super.classMethod() + ', too';
  }
}

Bar.classMethod() // "hello, too"
```

## 3.å®ä¾‹å±æ€§çš„æ–°å†™æ³•

å®ä¾‹å±æ€§é™¤äº†å®šä¹‰åœ¨<code style="color:#ea4335">constructor()</code>æ–¹æ³•é‡Œé¢çš„<code style="color:#ea4335">this</code>ä¸Šé¢,ä¹Ÿå¯ä»¥å®šä¹‰åœ¨ç±»çš„æœ€é¡¶å±‚

```js
class IncreasingCounter {
  constructor() {
    this._count = 0;
  }
  get value() {
    console.log('Getting the current value!');
    return this._count;
  }
  increment() {
    this._count++;
  }
}
```

ç­‰äº

```js
class IncreasingCounter {
  _count = 0;
  get value() {
    console.log('Getting the current value!');
    return this._count;
  }
  increment() {
    this._count++;
  }
}
```

è¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯:

æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡è‡ªèº«çš„å±æ€§éƒ½å®šä¹‰åœ¨ç±»çš„å¤´éƒ¨,çœ‹ä¸Šå»è¾ƒä¸ºæ•´é½

## 4.é™æ€å±æ€§

é™æ€å±æ€§æŒ‡çš„æ˜¯Classæœ¬èº«çš„å±æ€§,å³<code style="color:#ea4335">Class.proName</code>,è€Œä¸æ˜¯å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡(<code style="color:#ea4335">this</code>)ä¸Šçš„å±æ€§

å†™æ³•æ˜¯åœ¨å®ä¾‹å±æ€§çš„å‰é¢,åŠ ä¸Šstaticå…³é”®å­—

```js
class MyClass {
  static myStaticProp = 42;

  constructor() {
    console.log(MyClass.myStaticProp); // 42
  }
}
```

## 5. ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§

ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§ï¼Œæ˜¯åªèƒ½é€šè¿‡åœ¨ç±»çš„å†…éƒ¨è®¿é—®çš„æ–¹æ³•å’Œå±æ€§ï¼Œå¤–éƒ¨ä¸èƒ½è®¿é—®ï¼Œè¿™æ˜¯å¸¸è§éœ€æ±‚ï¼Œæœ‰åˆ©äºä»£ç çš„å°è£…ã€‚

### 5.1 ç°æœ‰çš„è§£å†³æ–¹æ¡ˆ

### 5.2 ç§æœ‰å±æ€§çš„ææ¡ˆ

æ­¤ææ¡ˆä¸º<code style="color:#ea4335">class</code>å¢åŠ äº†ç§æœ‰å±æ€§. æ–¹æ³•æ˜¯åœ¨å±æ€§åä¹‹å‰,ä½¿ç”¨<code style="color:#ea4335">#</code>è¡¨ç¤º

```js
class IncreasingCounter {
    #count = 0;
    get value() {
        console.log('Getting the current value!');
        return this.#count;
    }
    increment() {
        this.#count++;
    }
}

const counter = new IncreasingCounter();
counter.#count // æŠ¥é”™
counter.#count = 42 // æŠ¥é”™
```

another example

```js
class Point {
    #x;

    constructor(x = 0) {
        this.#x = +x;
    }

    get x() {
        return this.#x;
    }

    set x(value) {
        this.#x = +value;
    }
}

let point1 = new Point();

console.log(point1.x = 2);      //2
console.log(point1.x);          //2
```

ğŸ‘†ä»£ç ä¸­,<code style="color:#ea4335">#x</code>å°±æ˜¯ç§æœ‰å±æ€§,åœ¨<code style="color:#ea4335">Point</code>ç±»ä¹‹å¤–æ˜¯è¯»å–ä¸åˆ°è¿™ä¸ªå±æ€§çš„. ç”±äºäº•å·<code style="color:#ea4335">#</code>æ˜¯å±æ€§åçš„ä¸€éƒ¨åˆ†,ä½¿ç”¨æ—¶å¿…é¡»å¸¦<code style="color:#ea4335">#</code>ä¸€èµ·ä½¿ç”¨,æ‰€ä»¥<code style="color:#ea4335">#x</code>å’Œ<code style="color:#ea4335">x</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„å±æ€§

ä¹‹æ‰€ä»¥è¦å¼•å…¥ä¸€ä¸ªæ–°çš„å‰ç¼€<code style="color:#ea4335">#</code>è¡¨ç¤ºç§æœ‰å±æ€§,è€Œæ²¡æœ‰é‡‡ç”¨<code style="color:#ea4335">private</code>å…³é”®å­—,æ˜¯å› ä¸ºJavaScriptæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€,æ²¡æœ‰ç±»å‹å£°æ˜,ä½¿ç”¨ç‹¬ç«‹ç¬¦å·ä¼¼ä¹æ˜¯å”¯ä¸€æ¯”è¾ƒæ–¹ä¾¿å¯é çš„æ–¹æ³•

æ­¤å†™æ³•äº¦å¯ç”¨äºç§æœ‰æ–¹æ³•

```js
class Foo {
    #a;
    #b;
    constructor(a, b) {
        this.#a = a;
        this.#b = b;
    }
    #sum() {
        return this.#a + this.#b;
    }
    printSum() {
        console.log(this.#sum());
    }
}

let foo1 = new Foo(2,3);

console.log(foo1.printSum());
```

$\color{#B620E0}{
å­˜ç–‘:ç§æœ‰å±æ€§ä¹Ÿå¯ä»¥è®¾ç½®getterå’Œsetter

ğŸ‘‡è®¾ç½®æ˜¯å¦æ­£ç¡® åº”æ˜¯æ­£ç¡® ä½†å¸¦æŸ¥é˜…
}$

```js
class Counter {
    #xValue = 0;

    getx(){
        return this.#x;
    }

    setx(value){
        this.#x = value;
    }

    get #x() { return this.#xValue; }
    set #x(value) {
        this.#xValue = value;
    }
}

let counter = new Counter();

console.log(counter.getx());
counter.setx(999);
console.log(counter.getx());
```

ç§æœ‰å±æ€§ä¸é™äºä»<code style="color:#ea4335">this</code>å¼•ç”¨,åªè¦æ˜¯åœ¨ç±»çš„å†…éƒ¨,å®ä¾‹ä¹Ÿå¯ä»¥å¼•ç”¨ç§æœ‰å±æ€§

```js
class Foo {
  #privateValue = 42;
  static getPrivateValue(foo) {
    return foo.#privateValue;
  }
}

Foo.getPrivateValue(new Foo()); // 42
```

ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•å‰é¢,ä¹Ÿå¯ä»¥åŠ ä¸Š<code style="color:#ea4335">static</code>å…³é”®å­—,è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé™æ€çš„ç§æœ‰å±æ€§æˆ–ç§æœ‰æ–¹æ³•

```js
class FakeMath {
  static PI = 22 / 7;
  static #totallyRandomNumber = 4;

  static #computeRandomNumber() {
    return FakeMath.#totallyRandomNumber;
  }

  static random() {
    console.log('I heard you like random numbersâ€¦')
    return FakeMath.#computeRandomNumber();
  }
}

FakeMath.PI // 3.142857142857143
FakeMath.random()
// I heard you like random numbersâ€¦
// 4
FakeMath.#totallyRandomNumber // æŠ¥é”™
FakeMath.#computeRandomNumber() // æŠ¥é”™
```

### 5.3 è¿ç®—ç¬¦

<code style="color:#ea4335">in</code>è¿ç®—ç¬¦ç”¨æ¥åˆ¤æ–­ç§æœ‰å±æ€§

æ³¨æ„:åˆ¤æ–­ç§æœ‰å±æ€§æ—¶,<code style="color:#ea4335">in</code>åªèƒ½ç”¨åœ¨å®šä¹‰è¯¥ç§æœ‰å±æ€§çš„ç±»çš„å†…éƒ¨

```js
class A {
  #foo = 0;
  static test(obj) {
    console.log(#foo in obj);
  }
}

A.test(new A()) // true
A.test({}) // false

class B {
  #foo = 0;
}

A.test(new B()) // false
```

ğŸ‘†,ç±»<code style="color:#ea4335">A</code>çš„ç§æœ‰å±æ€§<code style="color:#ea4335">#foo</code>,åªèƒ½åœ¨ç±»<code style="color:#ea4335">A</code>å†…éƒ¨ä½¿ç”¨<code style="color:#ea4335">in</code>è¿ç®—ç¬¦åˆ¤æ–­,ä¸”åªå¯¹<code style="color:#ea4335">A</code>çš„å®ä¾‹è¿”å›<code style="color:#ea4335">true</code>,å¯¹äºå…¶å®ƒå¯¹è±¡éƒ½è¿”å›<code style="color:#ea4335">false</code>

å­ç±»ä»çˆ¶ç±»ç»§æ‰¿çš„ç§æœ‰å±æ€§,ä¹Ÿå¯ä»¥ä½¿ç”¨<code style="color:#ea4335">in</code>è¿ç®—ç¬¦æ¥åˆ¤æ–­

```js
class A {
  #foo = 0;
  static test(obj) {
    console.log(#foo in obj);
  }
}

class SubA extends A {};

A.test(new SubA()) // true
```

ğŸ‘†<code style="color:#ea4335">SubA</code>ä»çˆ¶ç±»ç»§æ‰¿äº†ç§æœ‰å±æ€§<code style="color:#ea4335">#foo</code>,<code style="color:#ea4335">in</code>è¿ç®—ç¬¦ä¹Ÿæœ‰æ•ˆ

$\color{#fbbc05}{Tips:}$

<code style="color:#ea4335">in</code>è¿ç®—ç¬¦å¯¹äº<code style="color:#ea4335">Object.create()</code>ã€<code style="color:#ea4335">Object.setPrototypeOf</code>å½¢æˆçš„ç»§æ‰¿æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºè¿™ç§ç»§æ‰¿ä¸ä¼šä¼ ç»Ÿç§æœ‰å±æ€§

```js
class A {
  #foo = 0;
  static test(obj) {
    console.log(#foo in obj);
  }
}
const a = new A();

const o1 = Object.create(a);
A.test(o1) // false
A.test(o1.__proto__) // true

const o2 = {};
Object.setPrototypeOf(o2, A);
A.test(o2) // false
A.test(o2.__proto__) // true
```

ğŸ‘†å¯¹äºä¿®æ”¹åŸå‹é“¾å½¢æˆçš„ç»§æ‰¿,å­ç±»éƒ½è·å–ä¸åˆ°çˆ¶ç±»çš„ç§æœ‰å±æ€§,æ‰€ä»¥<code style="color:#ea4335">in</code>è¿ç®—ç¬¦æ— æ•ˆ

## 6.é™æ€å—

$\color{#B620E0}{å­˜ç–‘:constructor()èŒƒå›´?}$

é™æ€å±æ€§çš„ä¸€ä¸ªé—®é¢˜æ˜¯,å®ƒçš„åˆå§‹åŒ–è¦ä¹ˆå†™åœ¨ç±»çš„å¤–éƒ¨,è¦ä¹ˆå†™åœ¨<code style="color:#ea4335">constructor()</code>é‡Œé¢

- å‰è€…å°†ç±»çš„å†…éƒ¨é€»è¾‘å†™åˆ°äº†å¤–éƒ¨
- åè€…åˆ™æ˜¯æ¯æ¬¡æ–°å»ºå®ä¾‹éƒ½ä¼šè¿è¡Œä¸€æ¬¡

```js
class C {
  static x = 234;
  static y;
  static z;
}

try {
  const obj = doSomethingWith(C.x);
  C.y = obj.y
  C.z = obj.z;
} catch {
  C.y = ...;
  C.z = ...;
}
```

ğŸ‘†The above example , static property <code style="color:#ea4335">y</code> and <code style="color:#ea4335">z</code> rely static property <code style="color:#ea4335">x</code>

For solving this problem , ES2022 import static block , which pemits set a block in the class , when class generate it will execute once , it's mainly effect is do initialization

```js
class C {
  static x = ...;
  static y;
  static z;

  static {
    try {
      const obj = doSomethingWith(this.x);
      this.y = obj.y;
      this.z = obj.z;
    }
    catch {
      this.y = ...;
      this.z = ...;
    }
  }
}
```

The above code 's advantage is it make the initial logic of the static property <code style="color:#ea4335">x</code> and <code style="color:#ea4335">y</code> written in the class , and it only execute once

Static block another effect is share private property and class for external code

```js
let getX;

export class C {
  #x = 1;
  static {
    getX = obj => obj.#x;
  }
}

console.log(getX(new C())); // 1
```

advantage:

formerly, it must written in the <code style="color:#ea4335">constructor</code> of class if we want to get <code style="color:#ea4335">#x</code>, so it will define <code style="color:#ea4335">getX()</code> once when new instance. but now it can written in the static block so that it only execute once when class genetate

$\color{#B620E0}{Question:}$

Use of arrow functions?
