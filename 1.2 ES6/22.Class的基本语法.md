# Classçš„åŸºæœ¬è¯­æ³•

- [Classçš„åŸºæœ¬è¯­æ³•](#classçš„åŸºæœ¬è¯­æ³•)
  - [1.ç®€ä»‹](#1ç®€ä»‹)
    - [1.1 ç±»çš„ç”±æ¥](#11-ç±»çš„ç”±æ¥)
    - [1.2 constructoræ–¹æ³•](#12-constructoræ–¹æ³•)
    - [1.3 ç±»çš„å®ä¾‹](#13-ç±»çš„å®ä¾‹)
  - [1.4 getter and setter](#14-getter-and-setter)
    - [1.5 å±æ€§è¡¨è¾¾å¼](#15-å±æ€§è¡¨è¾¾å¼)
    - [1.6 Classè¡¨è¾¾å¼](#16-classè¡¨è¾¾å¼)

## 1.ç®€ä»‹

### 1.1 ç±»çš„ç”±æ¥

JavaScriptè¯­è¨€ä¸­ï¼Œç”Ÿæˆå®ä¾‹å¯¹è±¡çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯é€šè¿‡æ„é€ å‡½æ•°

```js
function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.toString = function () {
  return '(' + this.x + ', ' + this.y + ')';
};

var p = new Point(1, 2);
```

è€ŒES6æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿè¯­è¨€çš„å†™æ³•,å¼•å…¥äº†Classæ¦‚å¿µ,ä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿,é€šè¿‡<code style="color:#ea4335">class</code>å…³é”®å­—,å¯ä»¥å®šä¹‰ç±»

```js
class Point {
    constructor(x, y) {
        this.x = x;
        this.y = y;
    }

    toString(){
        return '(' + this.x + ', ' + this.y + ')';
    }
}


typeof Point // "function"
Point === Point.prototype.constructor // true

let point1 = new Point(1,2);//(1,2)
console.log(point1.toString());
```

- è¿™ç§å†™æ³•ä¸å¼€å¤´æ„é€ å‡½æ•°<code style="color:#ea4335">Ponit</code>æ˜¯ä¸€è‡´çš„
- ç±»çš„æ•°æ®ç±»å‹å°±æ˜¯å‡½æ•°,ç±»æœ¬èº«å°±æŒ‡å‘æ„é€ å‡½æ•°
- ä½¿ç”¨çš„æ—¶å€™,ä¹Ÿæ˜¯ç›´æ¥å¯¹ç±»ä½¿ç”¨<code style="color:#ea4335">new</code>å‘½ä»¤,è·Ÿæ„é€ å‡½æ•°çš„ç”¨æ³•å®Œå…¨ä¸€è‡´

æ„é€ å‡½æ•°çš„<code style="color:#ea4335">prototype</code>å±æ€§,åœ¨ES6çš„"ç±»"ä¸Šç»§ç»­å­˜åœ¨

```js
class Point {
  constructor() {
    // ...
  }

  toString() {
    // ...
  }

  toValue() {
    // ...
  }
}

// ç­‰åŒäº

Point.prototype = {
  constructor() {},
  toString() {},
  toValue() {},
};
```

ç”±äºç±»çš„æ–¹æ³•éƒ½å®šä¹‰åœ¨<code style="color:#ea4335">prototype</code>å¯¹è±¡ä¸Šé¢,æ‰€ä»¥ç±»çš„æ–°æ–¹æ³•å¯ä»¥æ·»åŠ åœ¨<code style="color:#ea4335">prototype</code>å¯¹è±¡ä¸Šé¢.

<code style="color:#ea4335">Object.assign()</code>æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸€æ¬¡å‘ç±»æ·»åŠ å¤šä¸ªæ–¹æ³•

```js
Object.assign(Point.prototype, {
    toShit(){
        console.log("why invoke me? you this piece of shit");
    },
    toShit2(){}
  });

let point1 = new Point(1,2);
point1.toShit();
```

ç±»å’ŒES5è¡Œä¸ºä¸ä¸€è‡´çš„ç‚¹:

- ç±»çš„å†…éƒ¨æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•,éƒ½æ˜¯ä¸å¯æšä¸¾çš„(non-enumerable)
- ES5æ„é€ å‡½æ•°å†…éƒ¨å®šä¹‰çš„æ–¹æ³•æ˜¯å¯æšä¸¾çš„

```js
class Point {
  constructor(x, y) {
    // ...
  }
  toString() {
    // ...
  }
}
Object.keys(Point.prototype)
// []
Object.getOwnPropertyNames(Point.prototype)
// ["constructor","toString"]


var Point = function (x, y) {
  // ...
};
Point.prototype.toString = function () {
  // ...
};
Object.keys(Point.prototype)
// ["toString"]
Object.getOwnPropertyNames(Point.prototype)
// ["constructor","toString"]
```

### 1.2 constructoræ–¹æ³•

<code style="color:#ea4335">constructor()</code>æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•,é€šè¿‡<code style="color:#ea4335">new</code>å‘½ä»¤ç”Ÿæˆå¯¹è±¡å®ä¾‹æ—¶,è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•. ä¸€ä¸ªç±»å¿…é¡»æœ‰<code style="color:#ea4335">constructor()</code>æ–¹æ³•,è‹¥æ²¡æœ‰æ˜¾ç¤ºå®šä¹‰,ä¸€ä¸ªç©ºçš„<code style="color:#ea4335">constructor()</code>æ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ 

```js
class Point {
}

// ç­‰åŒäº
class Point {
  constructor() {}
}
```

<code style="color:#ea4335">constructor()</code>å‡½æ•°é»˜è®¤è¿”å›å®ä¾‹å¯¹è±¡(å³<code style="color:#ea4335">this</code>),å®Œå…¨å¯ä»¥æŒ‡å®šè¿”å›çš„å¦å¤–ä¸€ä¸ªå¯¹è±¡

```js
class Foo {
  constructor() {
    return Object.create(null);
  }
}

new Foo() instanceof Foo
// false
```

ç±»è·Ÿæ™®é€šå‡½æ•°çš„å¦ä¸€ä¸ªåŒºåˆ«:

ç±»å¿…é¡»ä½¿ç”¨<code style="color:#ea4335">new</code>æ‰å¯ä»¥æ‰§è¡Œ,åè€…ä¸ç”¨<code style="color:#ea4335">new</code>ä¹Ÿå¯ä»¥æ‰§è¡Œ

```js
class Foo {
  constructor() {
    return Object.create(null);
  }
}

Foo()
/**
  Uncaught TypeError: Class constructor Foo cannot be invoked without 'new'
 */
```

### 1.3 ç±»çš„å®ä¾‹

ä¸ES5ç›¸åŒ,å®ä¾‹çš„å±æ€§é™¤éå®šä¹‰åœ¨å…¶æœ¬èº«(å³å®šä¹‰åœ¨<code style="color:#ea4335">this</code>å¯¹è±¡ä¸Š),å¦åˆ™éƒ½æ˜¯å®šä¹‰åœ¨åŸå‹ä¸Š(å³å®šä¹‰åœ¨<code style="color:#ea4335">class</code>ä¸Š)

```js
//å®šä¹‰ç±»
class Point {

  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  toString() {
    return '(' + this.x + ', ' + this.y + ')';
  }

}

var point = new Point(2, 3);

point.toString() // (2, 3)

point.hasOwnProperty('x') // true
point.hasOwnProperty('y') // true
point.hasOwnProperty('toString') // false
point.__proto__.hasOwnProperty('toString') // true
```

ä¸ES5ç›¸åŒ,ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å¯¹è±¡

```js
var p1 = new Point(2,3);
var p2 = new Point(3,2);

p1.__proto__ === p2.__proto__
//true
```

  <code style="color:#ea4335">\_\_proto\_\_</code>å±æ€§å¹¶ä¸æ˜¯è¯­è¨€æœ¬èº«çš„ç‰¹æ€§,è€Œæ˜¯å„å¤§å‚å•†å®ç°æ—¶æ·»åŠ çš„ç§æœ‰å±æ€§,æ•…ä¸å»ºè®®åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¯¥å±æ€§, é¿å…å¯¹ç¯å¢ƒäº§ç”Ÿä¾èµ–. ç”Ÿäº§ç¯å¢ƒä¸­,å¯ä»¥ç”¨<code style="color:#ea4335">Object.getPrototypeOf</code>æ–¹æ³•æ¥è·å–å®ä¾‹å¯¹è±¡çš„åŸå‹,ç„¶åå†ä¸ºåŸå‹æ·»åŠ æ–¹æ³•/å±æ€§

```js
var p1 = new Point(2,3);
var p2 = new Point(3,2);

p1.__proto__.printName = function () { return 'Oops' };

p1.printName() // "Oops"
p2.printName() // "Oops"

var p3 = new Point(4,2);
p3.printName() // "Oops"
```

ğŸ‘†æ˜¯æ”¹å˜"ç±»"çš„åŸå§‹å®šä¹‰çš„ä¾‹å­

## 1.4 getter and setter

ä¸ES5ä¸€æ ·,åœ¨"ç±»"çš„å†…éƒ¨å¯ä»¥ä½¿ç”¨<code style="color:#ea4335">get</code>å’Œ<code style="color:#ea4335">set</code>å…³é”®å­—,å¯¹æŸä¸ªå±æ€§è®¾ç½®å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°,æ‹¦æˆªè¯¥å±æ€§çš„å­˜å–è¡Œä¸º

ğŸ‘‡ä»£ç ä¸­,<code style="color:#ea4335">prop</code>å±æ€§æœ‰å¯¹åº”çš„å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°,å› æ­¤å¤åˆ¶å’Œè¯»å–è¡Œä¸ºéƒ½è¢«è‡ªå®šä¹‰äº†

```js
class MyClass {
  constructor() {
    // ...
  }
  get prop() {
    return 'getter';
  }
  set prop(value) {
    console.log('setter: '+value);
  }
}

let inst = new MyClass();

inst.prop = 123;
// setter: 123

inst.prop
// 'getter'
```

å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°æ˜¯è®¾ç½®åœ¨å±æ€§çš„Descriptionå¯¹è±¡ä¸Šçš„

```js
class CustomHTMLElement {
  constructor(element) {
    this.element = element;
  }

  get html() {
    return this.element.innerHTML;
  }

  set html(value) {
    this.element.innerHTML = value;
  }
}

var descriptor = Object.getOwnPropertyDescriptor(
  CustomHTMLElement.prototype, "html"
);

console.table(descriptor);
```

ğŸ‘†![20211007215316](https://raw.githubusercontent.com/Logible/Image/main/note_image/20211007215316.png)

### 1.5 å±æ€§è¡¨è¾¾å¼

ç±»çš„å±æ€§å,å¯ä»¥é‡‡ç”¨è¡¨è¾¾å¼

```js
let methodName = 'getArea';

class Square {
  constructor(length) {
    // ...
  }

  [methodName]() {
    // ...
  }
}
```

### 1.6 Classè¡¨è¾¾å¼

ä¸å‡½æ•°ä¸€æ ·,ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼çš„å½¢å¼å®šä¹‰

```js
const MyClass = class Me {
  getClassName() {
    return Me.name;
  }
};
```

è¿™ä¸ªç±»çš„åå­—æ˜¯<code style="color:#ea4335">Me</code>,ä½†æ˜¯<code style="color:#ea4335">Me</code>åªåœ¨Classå†…éƒ¨å¯ç”¨,æŒ‡ä»£å½“å‰ç±»,åœ¨Classå¤–éƒ¨,è¿™ä¸ªç±»åªèƒ½ç”¨<code style="color:#ea4335">MyClass</code>å¼•ç”¨(æ•…å¯ä»¥çœç•¥<code style="color:#ea4335">Me</code>)

```js
let inst = new MyClass();
inst.getClassName() // Me
Me.name // ReferenceError: Me is not defined
```

é‡‡ç”¨<code style="color:#ea4335">Class</code>è¡¨è¾¾å¼,å¯ä»¥å†™å‡ºç«‹å³æ‰§è¡Œçš„Class

```js
let person = new class{
    constructor(name){
        this.name = name;
    }

    sayNmae(){
        console.log("My name is FuckYou",this.name);
    }
}('å§“å¼ åä¸‰');

person.sayNmae();    
```

### 1.7 æ³¨æ„ç‚¹

1. ä¸¥æ ¼æ¨¡å¼

    ç±»å’Œæ¨¡å—çš„å†…éƒ¨,é»˜è®¤å°±æ˜¯ä¸¥æ ¼æ¨¡å¼,æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨<code style="color:#ea4335">use strict</code>æŒ‡å®šè¿è¡Œæ¨¡å¼

    åªè¦ä»£ç å†™åœ¨ç±»/æ¨¡å—,å°±åªæœ‰ä¸¥æ ¼æ¨¡å¼å¯ç”¨

    è€ƒè™‘åˆ°æœªæ¥æ‰€æœ‰çš„ä»£ç å…¶å®éƒ½æ˜¯è¿è¡Œåœ¨æ¨¡å—ä¹‹ä¸­,æ‰€ä»¥ES6å®é™…ä¸ŠæŠŠæ•´ä¸ªè¯­è¨€å‡çº§åˆ°äº†ä¸¥æ ¼æ¨¡å¼

2. ä¸å­˜åœ¨æå‡

    ç±»ä¸å­˜åœ¨å˜é‡æå‡(hoist),è¿™ä¸€ç‚¹ä¸ES5å®Œå…¨ä¸åŒ

    - <code style="color:#ea4335">Foo</code>ç±»ä½¿ç”¨åœ¨å‰,å®šä¹‰åœ¨å,è¿™æ ·ä¼šæŠ¥é”™,å› ä¸ºES6ä¸ä¼šæŠŠç±»çš„å£°æ˜æå‡åˆ°ä»£ç å¤´éƒ¨
    - å­ç±»å¿…é¡»åœ¨çˆ¶ç±»ä¹‹åå®šä¹‰,è‹¥å­˜åœ¨<code style="color:#ea4335">class</code>çš„æå‡,ä¸Šé¢ä»£ç å°±ä¼šæŠ¥é”™,å› ä¸º<code style="color:#ea4335">class</code>ä¼šè¢«æå‡åˆ°ä»£ç å¤´éƒ¨,è€Œ<code style="color:#ea4335">let</code>å‘½ä»¤æ˜¯ä¸æå‡çš„,å¯¼è‡´<code style="color:#ea4335">Bar</code>ç»§æ‰¿<code style="color:#ea4335">Foo</code>çš„æ—¶å€™,<code style="color:#ea4335">Foo</code>å°šæœªå®šä¹‰

    ```js
    new Foo(); // ReferenceError
    class Foo {}

    {
      let Foo = class {};
      class Bar extends Foo {
      }
    }
    ```

3. nameå±æ€§

    ç”±äºæœ¬è´¨ä¸Š,ES6çš„ç±»åªæ˜¯ES5çš„æ„é€ å‡½æ•°çš„ä¸€å±‚åŒ…è£…,æ‰€ä»¥å‡½æ•°çš„è®¸å¤šç‰¹æ€§éƒ½è¢«<code style="color:#ea4335">Class</code>ç»§æ‰¿,åŒ…æ‹¬<code style="color:#ea4335">name</code>å±æ€§

    ```js
    class Point {}
    Point.name // "Point"
    ```

4. Generatoræ–¹æ³•

    å¾…å­¦

5. thisçš„æŒ‡å‘

    å¾…å­¦

## 2.é™æ€æ–¹æ³•

è‹¥åœ¨ä¸€ä¸ªæ–¹æ³•å‰,åŠ ä¸Š<code style="color:#ea4335">static</code>å…³é”®å­—,å°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿,è€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨,è¿™å°±ç§°ä¸º"é™æ€æ–¹æ³•"

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

Foo.classMethod() // 'hello'

var foo = new Foo();
foo.classMethod()
// TypeError: foo.classMethod is not a function
```

è‹¥é™æ€æ–¹æ³•ä¸­åŒ…å«<code style="color:#ea4335">this</code>å…³é”®å­—,æ•´ä¸ª<code style="color:#ea4335">this</code>æŒ‡çš„æ˜¯ç±»,è€Œä¸æ˜¯å®ä¾‹

```js
class Foo {
  static bar() {
    this.baz();
  }
  static baz() {
    console.log('hello');
  }
  baz() {
    console.log('world');
  }
}

Foo.bar() // hello
```

ğŸ‘†è¿˜å¯ä»¥çœ‹å‡º,é™æ€æ–¹æ³•å¯ä»¥ä¸éé™æ€æ–¹æ³•é‡å

çˆ¶ç±»çš„é™æ€æ–¹æ³•,å¯ä»¥è¢«å­ç±»ç»§æ‰¿

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

class Bar extends Foo {
}

Bar.classMethod() // 'hello'
```

é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥ä»<code style="color:#ea4335">super</code>å¯¹è±¡ä¸Šè°ƒç”¨

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

class Bar extends Foo {
  static classMethod() {
    return super.classMethod() + ', too';
  }
}

Bar.classMethod() // "hello, too"
```

## 3.å®ä¾‹å±æ€§çš„æ–°å†™æ³•

å®ä¾‹å±æ€§é™¤äº†å®šä¹‰åœ¨<code style="color:#ea4335">constructor()</code>æ–¹æ³•é‡Œé¢çš„<code style="color:#ea4335">this</code>ä¸Šé¢,ä¹Ÿå¯ä»¥å®šä¹‰åœ¨ç±»çš„æœ€é¡¶å±‚

```js
class IncreasingCounter {
  constructor() {
    this._count = 0;
  }
  get value() {
    console.log('Getting the current value!');
    return this._count;
  }
  increment() {
    this._count++;
  }
}
```

ç­‰äº

```js
class IncreasingCounter {
  _count = 0;
  get value() {
    console.log('Getting the current value!');
    return this._count;
  }
  increment() {
    this._count++;
  }
}
```

è¿™ç§å†™æ³•çš„å¥½å¤„æ˜¯:

æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡è‡ªèº«çš„å±æ€§éƒ½å®šä¹‰åœ¨ç±»çš„å¤´éƒ¨,çœ‹ä¸Šå»è¾ƒä¸ºæ•´é½
