# 补充点

## 事件循环

事件循环 的概念非常简单。它是一个在 JavaScript 引擎**等待任务，执行任务和进入休眠状态等待更多任务**这几个状态之间转换的无限循环。

引擎的一般算法：

1. 当有任务时：
   1. 从最先进入的任务开始执行。
2. 休眠直到出现任务，然后转到第 1 步。

当我们浏览一个网页时就是上述这种形式。JavaScript 引擎大多数时候不执行任何操作，它仅在脚本/处理程序/事件激活时执行。

任务示例：

- 当外部脚本`<script src="...">`加载完成时，任务就是执行它。
- 当用户移动鼠标时，任务就是派生出 mousemove 事件和执行处理程序。
- 当安排的（scheduled）setTimeout 时间到达时，任务就是执行其回调。

……诸如此类。
设置任务 —— 引擎处理它们 —— 然后等待更多任务（即休眠，几乎不消耗 CPU 资源）。

一个任务到来时，引擎可能正处于繁忙状态，那么这个任务就会被排入队列。

多个任务组成了一个队列，即所谓的“宏任务队列”

## 宏任务微任务

- 微任务仅来自于我们的代码。它们通常是由 promise 创建的：对`.then/catch/finally`处理程序的执行会成为微任务。微任务也被用于 await 的“幕后”，因为它是 promise 处理的另一种形式。

还有一个特殊的函数 queueMicrotask(func)，它对 func 进行排队，以在微任务队列中执行。

- 每个宏任务之后，引擎会**立即执行微任务队列中的所有任务**，然后再执行其他的宏任务，或渲染，或进行其他任何操作。
